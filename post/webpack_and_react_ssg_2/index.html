<!doctypehtml><html lang=ko><link href=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1 rel=icon><link href=https://blog.litehell.info/post/webpack_and_react_ssg_2 rel=canonical><link href=https://blog.litehell.info/post/webpack_and_react_ssg_2 hreflang=ko rel=alternate><link href=https://blog.litehell.info/post/webpack_and_react_ssg_2 hreflang=en rel=alternate><link title="RSS 2.0 Feed for LiteHell's blog"href=https://blog.litehell.info/feed/rss rel=alternate type=application/rss+xml><link title="Atom 1.0 Feed for LiteHell's blog"type="	application/atom+xml"href=https://blog.litehell.info/feed/atom rel=alternate><link title="Json 1.0 Feed for LiteHell's blog"href=https://blog.litehell.info/feed/json rel=alternate type=application/feed+json><link href=https://esm.sh/@wooorm/starry-night@3/style/core.css rel=stylesheet><link href=https://esm.sh/@wooorm/starry-night@3/style/both.css rel=stylesheet><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href=https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap rel=stylesheet><meta content="Webpack과 React를 이용한 정적 웹사이트 만들기 (2)"property=og:title><meta content="... + Static HTML Generation = TA-DA!"property=og:description><meta content=ko property=og:locale><meta content=blog property=og:type><meta content="LiteHell의 블로그"property=og:site_name><meta content=https://blog.litehell.info/post/webpack_and_react_ssg_2 property=og:url><meta content=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1 property=og:image><meta content=width=device-width,initial-scale=1 name=viewport><style>html,body{margin:0;padding:0;font-family:Noto Sans KR,sans-serif}</style><title>LiteHell의 블로그 - Webpack과 React를 이용한 정적 웹사이트 만들기 (2)</title><body><link as=image href=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1 rel=preload><link as=image href=https://i.creativecommons.org/l/by-sa/4.0/88x31.png rel=preload><link as=image href=https://www.gnu.org/graphics/agplv3-with-text-100x42.png rel=preload><style data-emotion="css 17rruta">.css-17rruta{--top-padding:max(40px,3rem);--vertical-padding:max(20px,2em);padding:var(--top-padding)var(--vertical-padding)0em var(--vertical-padding);box-sizing:border-box;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;align-items:center;min-height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}@media (prefers-color-scheme:dark){.css-17rruta{color:#eee;background:#1a1a1a}.css-17rruta a{color:#af7428}.css-17rruta a:hover,.css-17rruta a:active,.css-17rruta a:focus{color:#e98c13}}.css-17rruta>*{width:100%}@media (width>=1024px){.css-17rruta>*{max-width:960px}}.css-17rruta main{-webkit-flex:1;-ms-flex:1;flex:1}.css-17rruta footer{border-top:1px solid #727272;margin:2rem 0 0;padding:1.5rem 0}</style><div class=css-17rruta><style data-emotion="css 1fkv74n">.css-1fkv74n{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;align-items:center;gap:2rem;padding-bottom:1.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}@media (width<=25rem){.css-1fkv74n{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}}.css-1fkv74n .profileImg a{color:inherit;-webkit-text-decoration:none;text-decoration:none}.css-1fkv74n .profileImg img{border-radius:4rem;width:8rem;height:8rem;box-shadow:0 3px 6px #00000029,0 3px 6px #0000003b}.css-1fkv74n .title h1{word-break:keep-all;margin:0 0 .5rem;padding:0;font-size:2rem;line-height:2.5rem}.css-1fkv74n .title h1 a{color:inherit;-webkit-text-decoration:none;text-decoration:none}.css-1fkv74n .links{margin:0;padding:0;font-size:.9rem;line-height:1.2rem}@media (width<=1023px){.css-1fkv74n .title h1{font-size:1.5rem;line-height:2rem}.css-1fkv74n .rounded img{border-radius:3.5rem 3.4rem;width:7rem;height:7rem}}</style><header class=css-1fkv74n><div class=profileImg><a href=/><img alt="LiteHell의 Gravatar 아이콘"src=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1></a></div><div class=title><h1><a href=/>LiteHell의 블로그</a></h1><p class=links>외부고리: <a href=https://github.com/litehell>GitHub</a>, <a href=https://yeonjin.name/portfolio>Portfolio</a><br>내부고리: <a href=/categories>카테고리</a>, <a href=/tags>태그</a><br>다른 언어: <a href=https://blog-en.litehell.info hreflang=en>영어 (English)</a></p><style data-emotion="css ioj8ye">.css-ioj8ye{color:#374c64;font-size:75%}@media (prefers-color-scheme:dark){.css-ioj8ye{color:#999}}</style><p class=css-ioj8ye>글 쓸 때는 AI를 안 씁니다. 전부 직접 씁니다. 만약 오탈자나 어색한 문장이 있다면 퇴고를 대충해서 그런거니 양해 부탁드립니다.<br>블로그의 모든 시간 및 날짜는 별도의 언급이 없다면 한국 표준 시간대입니다.</div></header><main><div><style data-emotion="css 1v4sk1e">.css-1v4sk1e{border-bottom:1px solid #999;margin-bottom:.8rem;padding:1.5rem 0 2rem}.css-1v4sk1e .title{margin-bottom:.25rem}.css-1v4sk1e .title *{margin:0;padding:0;display:inline}.css-1v4sk1e .title h2{font-size:2rem;line-height:2.1rem}.css-1v4sk1e .title h3{margin-left:1rem;font-size:1rem;font-weight:200;line-height:1rem}.css-1v4sk1e .datetime{color:#666;margin:0;padding:0}.css-1v4sk1e .links .description{color:#666}</style><div class=css-1v4sk1e><div class=title><h2>Webpack과 React를 이용한 정적 웹사이트 만들기 (2)</h2><h3>... + Static HTML Generation = TA-DA!</h3></div><p class=datetime>2023. 1. 10. 오후 2:00:54에 LiteHell이(가) 작성함.<div class=links><div class=link><span class=description>카테고리: </span><a href=/category/Dev>Dev</a></div><div class=link><span class=description>태그: </span><a href=/tag/React>React</a></div></div></div><style data-emotion="css 11xq4y7">.css-11xq4y7{background:#ddd;border:1px solid #666;border-radius:4px;padding:1em}@media (prefers-color-scheme:dark){.css-11xq4y7{color:#ebebeb;background:#2c2c2c}}.css-11xq4y7 .title,.css-11xq4y7 .active{font-weight:600}.css-11xq4y7 ul{margin:1em 0 0}</style><nav class=css-11xq4y7><div class=title>(시리즈) Webpack과 React를 이용한 정적 웹사이트 만들기</div><ul><li><a href=/post/webpack_and_react_ssg_3>Webpack과 React를 이용한 정적 웹사이트 만들기 (3)</a><li><a class=active href=/post/webpack_and_react_ssg_2>Webpack과 React를 이용한 정적 웹사이트 만들기 (2)</a><li><a href=/post/webpack_and_react_ssg_1>Webpack과 React를 이용한 정적 웹사이트 만들기 (1)</a></ul></nav><style data-emotion="css xljd47">.css-xljd47{padding:10px;font-size:1rem;line-height:180%}@font-face{font-family:D2Coding;src:url(https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_three@1.0/D2Coding.woff)format("woff");font-weight:400;font-display:swap}.css-xljd47 pre{background:#f0f0f0;border-radius:6px;padding:.5em 1em;overflow-x:auto}@media (prefers-color-scheme:dark){.css-xljd47 pre{color:#ebebeb;background:#383838}}.css-xljd47 code{font-family:Fira Code,Source Code Pro,JetBrains Mono,Roboto Mono,DejaVu Sans Mono,DejaVu Mono,Inconsolata,Monaco,Consolas,Hack,Ubuntu Mono,Red Hat Mono,D2 coding,monospace}.css-xljd47 h1{margin:1.8rem 0;font-size:1.8rem}.css-xljd47 h1:before{content:"# ";color:#a19c91}.css-xljd47 h2{margin:1.6rem 0;font-size:1.6rem}.css-xljd47 h2:before{content:"## ";color:#a19c91}.css-xljd47 h3{margin:1.4rem 0;font-size:1.4rem}.css-xljd47 h3:before{content:"### ";color:#a19c91}.css-xljd47 h4{margin:1.2rem 0;font-size:1.2rem}.css-xljd47 h5{margin:1.15rem 0;font-size:1.15rem}.css-xljd47 h5:before{content:"> ";color:#a19c91}.css-xljd47 h6{margin:1.1rem 0;font-size:1.1rem}.css-xljd47 h6:before{content:">> ";color:#a19c91}.css-xljd47 img,.css-xljd47 iframe{max-width:80%;margin:0 auto;display:block}.css-xljd47 table{white-space:nowrap;border-collapse:collapse;display:block;overflow-x:auto}.css-xljd47 table td,.css-xljd47 table tr,.css-xljd47 table th{border:1px solid gray}.css-xljd47 table th{font-weight:700}.css-xljd47 table th,.css-xljd47 table td{padding:5px 10px}.css-xljd47 table thead{background:#d8d8d8}@media (prefers-color-scheme:dark){.css-xljd47 table thead{color:#fff;background:#666}}.css-xljd47 blockquote{background:#c2c2c2;border-left:5px solid #4e4e4e;margin:25px 10px 25px 30px;padding:10px 50px}@media (prefers-color-scheme:dark){.css-xljd47 blockquote{color:#ccc;background:#4f4f4f;border-left:5px solid #cacaca}}.css-xljd47 ul li,.css-xljd47 ol li{margin:6px 0}</style><article class=css-xljd47><h1>들어가는 글</h1><p>1편에서와 같이 개발하면 매우 잘 된다, 구조가 단순하기 때문이다. 1편의 방식을 개발했을 때 빌드된 결과물을 보면 다음과 같이 생겼을 것이다.<pre><code class=language-html><span class=pl-c>&LT!-- dist/index.html --></span>
<span class=pl-c>&LT!-- 참고로 이 예시는 예시일뿐이며, 세부사항은 개개인의 상황에 따라 다를 수 있다. --></span>
&LT!doctype html>
<<span class=pl-ent>html</span>>
    <<span class=pl-ent>head</span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>charset</span>=<span class=pl-s><span class=pl-pds>"</span>utf-8<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>title</span>>Lorem ipsum&LT/<span class=pl-ent>title</span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>name</span>=<span class=pl-s><span class=pl-pds>"</span>viewport<span class=pl-pds>"</span></span> <span class=pl-e>content</span>=<span class=pl-s><span class=pl-pds>"</span>width=device-width,initial-scale=1<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>script</span> <span class=pl-e>defer</span>=<span class=pl-s><span class=pl-pds>"</span>defer<span class=pl-pds>"</span></span> <span class=pl-e>src</span>=<span class=pl-s><span class=pl-pds>"</span>166.js<span class=pl-pds>"</span></span>>&LT/<span class=pl-ent>script</span>>
        <<span class=pl-ent>script</span> <span class=pl-e>defer</span>=<span class=pl-s><span class=pl-pds>"</span>defer<span class=pl-pds>"</span></span> <span class=pl-e>src</span>=<span class=pl-s><span class=pl-pds>"</span>main.js<span class=pl-pds>"</span></span>>&LT/<span class=pl-ent>script</span>>
    &LT/<span class=pl-ent>head</span>>
    <<span class=pl-ent>body</span>>

    &LT/<span class=pl-ent>body</span>>
&LT/<span class=pl-ent>html</span>>
</code></pre><p>1편에서 번들링된 파일이 script 태그로 삽입되어 HTML 문서가 불려와진 후 모두 끝난 후 실행되는 형태이다. (<code>defer</code>속성은 스크립트가 문서 분석 이후에 실행되도록 한다.)<p>즉, <strong>CSR(Client-Side Rendering)</strong> 방식이다. body 태그 내에 div 태그를 만들고 해당 태그에 React Component를 렌더링하는 코드가 클라이언트단에서 모두 실행되는 방식이다. 빌드 단계에서 렌더링이 이루어지지 않으며, 빌드 단계에서 이루어지는 것은 오직 코드 번들링뿐이다.<p>리소스가 한 번만 로드되고 후속 페이지 로드시간이 빠르다는 장점이 있지만 몇가지 단점도 있다.<ul><li>SEO(검색 엔진 최적화)에 불리하다.<li>초기 페이지 로드시간이 느리며, 다 로드되기 전까진 흰 화면만 뜬다. (필요한 JavaScript와 CSS를 다 불러와야 하기 때문이다.)</ul><p>이러한 단점들을 극복하려면 어떻게 해야할까?<h2>with React Hydration</h2><p>빌드시에 초기 HTML을 생성하고, 진입 스크립트을 hydration을 하는 방식으로 수정하면 된다. 여기서 hydration이란 ReactDOMServer에 의해 렌더링된 초기 마크업 코드에 이벤트 리스너를 연결(즉, 요약하자면 재활용)하는 것이다.<p>이 방식을 이용하면 HTML 마크업 코드는 빌드 단계에서 생성되고, 클라이언트단에서는 React가 이미 생성된 HTML 코드에 부착(attach)하여 동작한다. 이 방식의 장점은 다음과 같다.<ul><li>SEO(검색 엔진 최적화)에 유리하다.<li>JavaScript와 CSS가 다 불려와지기 전까지 흰화면만 뜨는 현상을 수정할 수 있다.</ul><p>이 방식을 채택하기 전에 먼지 어떤 사항을 확인해야 하는지 한 번 알아보자.<h3>유효한 HTML코드 작성</h3><p>모든 HTML 코드는 유효하게 작성되어야 한다. 예시를 들자면, p태그 안에는 p태그가 들어갈 수 없다.<p>React hydration을 하기 위해서는, 빌드단에서 생성된 HTML 코드와 React Component가 생성하는 UI 코드가 일치해야 한다. 만약 초기 UI 불일치 오류가 나타난다면, 유효하지 않은 HTML 코드를 작성한 건 아닌지 한 번 확인해봐야 한다.<h3>클라이언트단에서만 작동하는 코드 수정</h3><p>Node.js 환경에서 실행되면 오류가 나는 코드가 있다. 이런 코드들은 브라우저 환경에서만 실행되도록 수정해야 한다.<pre><code class=language-tsx>// 예시

const isBrowser = () => typeof window !== 'undefined' && typeof document !== 'undefined'

if (isBrowser())
    import('../some_module_that_works_only_on_browser');
</code></pre><p>또한, 브라우저단에서 결과가 결정되거나 항상 일정하지 않은 코드는 <code>useEffect</code> 등을 이용해 UI가 렌더링된 이후에 실행되도록 수정해야 한다. <code>useState</code>와 <code>useEffect</code> 등은 브라우저단에서만 렌더링된다.<pre><code class=language-tsx>import { useState, useEffect } from 'react';

// 예시
export default function AreYouKorean() {
    // const isKorean = navigator.language === 'ko';
    const [isKorean, setIsKorean] = useState&LTboolean | null>(null);
    useEffect(() => {
        setIsKorean(navigator.language === 'ko');
    });

    let message: string = '...';
    if (isKorean !== null)
        message = isKorean ? '한국인이시군요.' : "You're not Korean!";
    return &LTdiv>{ message }&LT/div>
}
</code></pre><h3>결과가 불명확한 코드 수정</h3><p>이런 코드는 당연히 빌드할 때 생긴 초기 UI와 클라이언트 렌더링시의 초기 UI가 서로 다르게 한다. 빌드시 시간의 초 단위가 짝수면 결과는 *Yes!*가 렌더링될텐데, 사용자가 로드할 때 시간이 홀수면 *No!*가 렌더링되니 서로 불일치하다. 이런 코드가 있다면 수정해야 한다.<pre><code class=language-tsx>export default function isTimeEven() {
    const time = (new Date()).getSeconds() % 2 === 0;
    return time ? &LTp> Yes! &LT/p> : &LTp> No! &LT/p>;
}
</code></pre><h2>hydration 적용</h2><p>위에서 언급한 문제를 모두 수정했다면 hydration시 초기 UI 불일치 오류는 없을 것이다. 이제 hydration을 적용해보자.<h3>진입 스크립트 수정</h3><p>먼저, hydrate하도록 <code>src/index.tsx</code>를 수정하자.<pre><code class=language-tsx>// src/index.tsx

import React from 'react';
import ReactDOM from 'react-dom/client';
import '../styles/index.css';
import isBrowser from './isBrowser';

export default function Index() {
    return &LTdiv className="bg-gray-400">
      Hello, World!
    &LT/div>
}

// 만약 브라우저라면
if (isBrowser()) {
    // body > #root 태그에
    const rootDiv = document.querySelector('body > #root')!;
    // hydration이 필요하다면 (빌드 결과물)
    if (rootDiv.classList.contains('hydrate')) {
        // Index 컴포넌트를 hydrate한다.
        ReactDOM.hydrateRoot(rootDiv, &LTIndex />);
    } else /* 만약 hydration이 필요없다면 (webpack serve) */ {
        // 그냥 렌더링 한다.
        const root = ReactDOM.createRoot(rootDiv);
        root.render(&LTIndex />)
    }
}
</code></pre><p>브라우저 환경 여부를 판단하는 <code>src/isBrowser.ts</code>도 간단하게 작성한다.<pre><code class=language-ts><span class=pl-c>// src/isBrowser.ts</span>

<span class=pl-k>export</span> <span class=pl-k>default</span> <span class=pl-k>function</span> <span class=pl-en>isBrowser</span> () {
    <span class=pl-k>return</span> <span class=pl-k>typeof</span> <span class=pl-c1>window</span> <span class=pl-k>!==</span> <span class=pl-s><span class=pl-pds>'</span>undefined<span class=pl-pds>'</span></span> <span class=pl-k>&&</span> <span class=pl-k>typeof</span> <span class=pl-c1>document</span> <span class=pl-k>!==</span> <span class=pl-s><span class=pl-pds>'</span>undefined<span class=pl-pds>'</span></span>;
}
</code></pre><p><code>src/index.tsx</code>는 빌드 스크립트에서도 import된다. 따라서 브라우저단에서만 실행되야 하는 코드는 브라우저단에서만 실행되도록 수정해야 한다.<h3>HTML 템플릿 생성</h3><p>그 다음으로, 간단한 HTML 템플릿을 생성한다.<pre><code class=language-html><span class=pl-c>&LT!-- src/index.html --></span>

&LT!DOCTYPE html>
<<span class=pl-ent>html</span> <span class=pl-e>lang</span>=<span class=pl-s><span class=pl-pds>"</span>ko<span class=pl-pds>"</span></span>>
    <<span class=pl-ent>head</span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>charset</span>=<span class=pl-s><span class=pl-pds>"</span>utf8<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>name</span>=<span class=pl-s><span class=pl-pds>"</span>viewport<span class=pl-pds>"</span></span> <span class=pl-e>content</span>=<span class=pl-s><span class=pl-pds>"</span>width=device-width, initial-scale=1<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>http-equiv</span>=<span class=pl-s><span class=pl-pds>"</span>X-UA-Compatible<span class=pl-pds>"</span></span> <span class=pl-e>content</span>=<span class=pl-s><span class=pl-pds>"</span>IE=edge<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>title</span>>Lorem ipsum&LT/<span class=pl-ent>title</span>>
    &LT/<span class=pl-ent>head</span>>
    <<span class=pl-ent>body</span>>
        <<span class=pl-ent>div</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>root<span class=pl-pds>"</span></span>>

        &LT/<span class=pl-ent>div</span>>
    &LT/<span class=pl-ent>body</span>>
&LT/<span class=pl-ent>html</span>>
</code></pre><h3>HTML 생성 스크립트 추가</h3><p>초기 HTML 코드를 생성하는 스크립트를 작성해야 한다. 먼저 스크립트 작성 전에 의존성을 몇가지 설치하자.<pre><code class=language-bash>yarn add cheerio tmp-promise
</code></pre><p>그 다음으로, 다음과 같이 스크립트를 작성한다.<pre><code class=language-tsx>// src/generate.tsx

import { load as loadHTML } from 'cheerio';
import { createWriteStream, promises as fs } from 'fs';
import React from 'react';
import server from 'react-dom/server';
import tmp from 'tmp-promise';
import Index from './index';

(async () => {
    // 임시 파일을 생성한다.
    const tmpFile = await tmp.file();

    // Webpack 번들러에 의해 생성된 HTML 파일의 위치이다.
    const filename = './dist/index.html';

    // 초기 UI 코드를 생성하는 ReactDOMServer의 스트림이다.
    const reactStream = server.renderToPipeableStream(&LTIndex />);
    
    // 스트림을 임시 파일에 쓴다.
    const fileStream = createWriteStream(tmpFile.path);
    
    // 초기 UI 코드가 임시 파일에 모두 써졌으면
    reactStream.pipe(fileStream).on('finish', async () => {
        // 웹팩에 의해 번들링된 HTML 파일을 읽는다.
        const htmlText = await fs.readFile(filename, { encoding: 'utf8' });

        // HTML 파일의 id가 root인 태그에 초기 UI 코드를 넣는다.
        const dom = loadHTML(htmlText);
        dom('body > #root').html(await fs.readFile(tmpFile.path, { encoding: 'utf8' }));
        dom('body > #root').addClass('hydrate');
        dom('body > #root');

        // HTML 코드를 저장한다.
        await fs.writeFile(filename, dom.html());
    });
})();
</code></pre><h3>Webpack 설정 수정</h3><p>Webpack 설정 파일에 생성 스크립트로 번들링하는 설정을 추가한다. Node.js를 타켓팅할 시 일부 모듈은 C/C++ 에드온을 이용할 수 있다. 따라서 해당 경우에 대응할 수 있도록 <a href=https://www.npmjs.com/package/node-loader>node-loader</a> 의존성을 같이 설치한다. (만약 그러한 모듈이 없다면 이 문단에서 <code>.node</code> 관련 내용은 무시해도 된다.) <a href=https://www.npmjs.com/package/empty-loader>empty-loader</a> 모듈은 빌드 스크립트에서 CSS 파일을 무시하는 데 이용된다.<pre><code class=language-bash>yarn add --dev node-loader empty-loader
</code></pre><p>그리고 다음과 같이 <code>webpack.config.js</code>를 수정한다.<pre><code class=language-js><span class=pl-c>// webpack.config.js</span>

<span class=pl-k>const</span> <span class=pl-c1>path</span> <span class=pl-k>=</span> <span class=pl-c1>require</span>(<span class=pl-s><span class=pl-pds>'</span>path<span class=pl-pds>'</span></span>);
<span class=pl-k>const</span> <span class=pl-c1>HtmlWebpackPlugin</span> <span class=pl-k>=</span> <span class=pl-c1>require</span>(<span class=pl-s><span class=pl-pds>'</span>html-webpack-plugin<span class=pl-pds>'</span></span>)
<span class=pl-k>const</span> { <span class=pl-c1>CleanWebpackPlugin</span> } <span class=pl-k>=</span> <span class=pl-c1>require</span>(<span class=pl-s><span class=pl-pds>'</span>clean-webpack-plugin<span class=pl-pds>'</span></span>);

<span class=pl-k>const</span> <span class=pl-c1>dev</span> <span class=pl-k>=</span> <span class=pl-c1>process</span>.<span class=pl-smi>env</span>.<span class=pl-c1>NODE_ENV</span> <span class=pl-k>===</span> <span class=pl-s><span class=pl-pds>'</span>development<span class=pl-pds>'</span></span>;

<span class=pl-c>// src/index.tsx 설정과 src/generate.ts 설정에 공통적으로 들어가는 항목들이다.</span>
<span class=pl-k>const</span> <span class=pl-c1>commons</span> <span class=pl-k>=</span> {
    mode<span class=pl-k>:</span> dev <span class=pl-k>?</span> <span class=pl-s><span class=pl-pds>"</span>development<span class=pl-pds>"</span></span> <span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>"</span>production<span class=pl-pds>"</span></span>,
    resolve<span class=pl-k>:</span> {
        <span class=pl-c>// .node가 추가되었다.</span>
        extensions<span class=pl-k>:</span> [<span class=pl-s><span class=pl-pds>'</span>.tsx<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>.ts<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>.js<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>.css<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>.node<span class=pl-pds>'</span></span>]
    },
    module<span class=pl-k>:</span> {
        rules<span class=pl-k>:</span> [
            {
                test<span class=pl-k>:</span> <span class=pl-k>/</span>\.<span class=pl-smi>tsx</span><span class=pl-k>?</span>$<span class=pl-k>/</span>,
                exclude<span class=pl-k>:</span> <span class=pl-k>/</span>node_modules<span class=pl-k>/</span>,
                use<span class=pl-k>:</span> [
                    {
                        loader<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>babel-loader<span class=pl-pds>'</span></span>,
                        options<span class=pl-k>:</span> {
                            presets<span class=pl-k>:</span> [<span class=pl-s><span class=pl-pds>'</span>@babel/preset-react<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>@babel/preset-env<span class=pl-pds>'</span></span>]
                        }
                    },
                    <span class=pl-s><span class=pl-pds>'</span>ts-loader<span class=pl-pds>'</span></span>
                ]
            },
            {
                <span class=pl-c>// .node 파일을 로드한다.</span>
                test<span class=pl-k>:</span> <span class=pl-k>/</span>\.<span class=pl-smi>node$</span><span class=pl-k>/</span>,
                use<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>node-loader<span class=pl-pds>'</span></span>
            }
        ]
    },
    plugins<span class=pl-k>:</span> [<span class=pl-k>new</span> <span class=pl-en>CleanWebpackPlugin</span>()]
};

<span class=pl-c1>module</span>.<span class=pl-smi>exports</span> <span class=pl-k>=</span> [<span class=pl-c>/* src/index.tsx 설정 */</span>{
    <span class=pl-k>...</span>commons,
    optimization<span class=pl-k>:</span> {
      splitChunks<span class=pl-k>:</span> {
        chunks<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>all<span class=pl-pds>'</span></span>
      },
      minimize<span class=pl-k>:</span> <span class=pl-k>!</span>dev
    },
    entry<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>./src/index.tsx<span class=pl-pds>'</span></span>,
    output<span class=pl-k>:</span> {
        path<span class=pl-k>:</span> <span class=pl-smi>path</span>.<span class=pl-en>resolve</span>(<span class=pl-c1>__dirname</span>, <span class=pl-s><span class=pl-pds>'</span>dist<span class=pl-pds>'</span></span>),
        filename<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>[name].js<span class=pl-pds>'</span></span>
    },
    module<span class=pl-k>:</span> {
        <span class=pl-k>...</span><span class=pl-smi>commons</span>.<span class=pl-smi>module</span>,
        rules<span class=pl-k>:</span> [
            <span class=pl-k>...</span><span class=pl-smi>commons</span>.<span class=pl-smi>module</span>.<span class=pl-c1>rules</span>,
            <span class=pl-c>// CSS를 빌드시 로드하도록 하면 오류가 발생한다. (Node.js 환경은 웹브라우저가 아니므로 스타일 주입 시도가 당연히 실패하기 때문이다.)</span>
            <span class=pl-c>// 따라서 css파일은 웹브라우저단에서 로드되는 번들 스크립트에서만 주입되도록 </span>
            <span class=pl-c>// src/index.tsx Webpack 설정에만 추가한다.</span>
            {
                test<span class=pl-k>:</span> <span class=pl-k>/</span>\.<span class=pl-smi>css$</span><span class=pl-k>/</span>,
                use<span class=pl-k>:</span> [<span class=pl-s><span class=pl-pds>'</span>style-loader<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>css-loader<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>postcss-loader<span class=pl-pds>'</span></span>]
            },
        ]
    },
    plugins<span class=pl-k>:</span> [
        <span class=pl-k>...</span><span class=pl-smi>commons</span>.<span class=pl-c1>plugins</span>,
        <span class=pl-k>new</span> <span class=pl-en>HtmlWebpackPlugin</span>({
        filename<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>index.html<span class=pl-pds>'</span></span>,
        <span class=pl-c>// template 속성을 추가한다.</span>
        template<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>./src/index.html<span class=pl-pds>'</span></span>
    })],
    devServer<span class=pl-k>:</span> {
        static<span class=pl-k>:</span> {directory<span class=pl-k>:</span> <span class=pl-smi>path</span>.<span class=pl-c1>join</span>(<span class=pl-c1>__dirname</span>, <span class=pl-s><span class=pl-pds>'</span>dist<span class=pl-pds>'</span></span>)},
        open<span class=pl-k>:</span> <span class=pl-c1>true</span>,
        port<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>auto<span class=pl-pds>'</span></span>,
    },
    watchOptions<span class=pl-k>:</span> {
        ignored<span class=pl-k>:</span> <span class=pl-k>/</span>node_modules<span class=pl-k>/</span>
    }
}, <span class=pl-c>/* src/generate.tsx 설정 */</span> {
    <span class=pl-k>...</span>commons,
    <span class=pl-c>// node로 실행할 스크립트이기 때문에 target을 node로 한다.</span>
    target<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>node<span class=pl-pds>'</span></span>,
    <span class=pl-c>// entry는 src/generate.tsx로 한다.</span>
    entry<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>./src/generate.tsx<span class=pl-pds>'</span></span>,
    module<span class=pl-k>:</span> {
        <span class=pl-k>...</span><span class=pl-smi>commons</span>.<span class=pl-smi>module</span>,
        rules<span class=pl-k>:</span> [
            <span class=pl-k>...</span><span class=pl-smi>commons</span>.<span class=pl-smi>module</span>.<span class=pl-c1>rules</span>,
            {
                <span class=pl-c>// css파일은 무시한다.</span>
                test<span class=pl-k>:</span> <span class=pl-k>/</span>\.<span class=pl-smi>css$</span><span class=pl-k>/</span>,
                use<span class=pl-k>:</span> [<span class=pl-s><span class=pl-pds>'</span>empty-loader<span class=pl-pds>'</span></span>]
            },
        ]
    },
    output<span class=pl-k>:</span> {
        path<span class=pl-k>:</span> <span class=pl-smi>path</span>.<span class=pl-en>resolve</span>(<span class=pl-c1>__dirname</span>, <span class=pl-s><span class=pl-pds>'</span>dist-builder<span class=pl-pds>'</span></span>),
        filename<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>index.js<span class=pl-pds>'</span></span>
    }
}]
</code></pre><h2>빌드 스크립트 실행</h2><p>이제 거의 다 됐다. 다음 명령어로 빌드해보자.<pre><code class=language-bash>npx webpack build
node ./dist-builder
</code></pre><p>별 다른 오류없이 잘 될 것이다. 축하한다. 이제 앞으로 위 명령어로 빌드하면 초기 HTML 코드가 들어가있는 파일이 빌드될 것이다. 해당 빌드의 결과는 다음과 같다.<pre><code class=language-html><span class=pl-c>&LT!-- dist/index.html --></span>
<span class=pl-c>&LT!-- 참고로 이 예시는 예시일뿐이며, 세부사항은 개개인의 상황에 따라 다를 수 있다. --></span>
&LT!DOCTYPE html>
<<span class=pl-ent>html</span> <span class=pl-e>lang</span>=<span class=pl-s><span class=pl-pds>"</span>ko<span class=pl-pds>"</span></span>>
    <<span class=pl-ent>head</span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>charset</span>=<span class=pl-s><span class=pl-pds>"</span>utf8<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>name</span>=<span class=pl-s><span class=pl-pds>"</span>viewport<span class=pl-pds>"</span></span> <span class=pl-e>content</span>=<span class=pl-s><span class=pl-pds>"</span>width=device-width,initial-scale=1<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>meta</span> <span class=pl-e>http-equiv</span>=<span class=pl-s><span class=pl-pds>"</span>X-UA-Compatible<span class=pl-pds>"</span></span> <span class=pl-e>content</span>=<span class=pl-s><span class=pl-pds>"</span>IE=edge<span class=pl-pds>"</span></span>>
        <<span class=pl-ent>title</span>>Lorem ipsum&LT/<span class=pl-ent>title</span>>
        <<span class=pl-ent>script</span> <span class=pl-e>defer</span>=<span class=pl-s><span class=pl-pds>"</span>defer<span class=pl-pds>"</span></span> <span class=pl-e>src</span>=<span class=pl-s><span class=pl-pds>"</span>166.js<span class=pl-pds>"</span></span>>&LT/<span class=pl-ent>script</span>>
        <<span class=pl-ent>script</span> <span class=pl-e>defer</span>=<span class=pl-s><span class=pl-pds>"</span>defer<span class=pl-pds>"</span></span> <span class=pl-e>src</span>=<span class=pl-s><span class=pl-pds>"</span>main.js<span class=pl-pds>"</span></span>>&LT/<span class=pl-ent>script</span>>
    &LT/<span class=pl-ent>head</span>>
    <<span class=pl-ent>body</span>>
        <<span class=pl-ent>div</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>root<span class=pl-pds>"</span></span>>
            <<span class=pl-ent>div</span> <span class=pl-e>class</span>=<span class=pl-s><span class=pl-pds>"</span>bg-gray-400<span class=pl-pds>"</span></span>>Hello, World!&LT/<span class=pl-ent>div</span>>
        &LT/<span class=pl-ent>div</span>>
    &LT/<span class=pl-ent>body</span>>
&LT/<span class=pl-ent>html</span>>
</code></pre></article><style data-emotion="css ly0ba3">.css-ly0ba3 .utterances{max-width:100%!important}</style><div class=css-ly0ba3><script label="blog comment"async crossorigin issue-term=webpack_and_react_ssg_2 repo=LiteHell/litehell-blog src=https://utteranc.es/client.js theme=preferred-color-scheme></script></div><style data-emotion="css eyxei3">.css-eyxei3{-webkit-box-flex-wrap:wrap;-webkit-flex-flow:wrap;-ms-flex-flow:wrap;flex-flow:wrap;justify-content:space-between;gap:1em .5em;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-eyxei3 a{-webkit-text-decoration:none;text-decoration:none}.css-eyxei3 .inner{vertical-align:top;display:inline-block}.css-eyxei3 .inner .title{font-size:1.3em;line-height:1.3rem}.css-eyxei3 .inner .subtitle{margin-top:.2rem;font-size:1rem;font-weight:200;line-height:1rem}.css-eyxei3 .inner .date{font-size:.8em;font-weight:200;line-height:.8rem}.css-eyxei3 .next,.css-eyxei3 .previous{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:.5em;width:max-content;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-eyxei3 .next.next,.css-eyxei3 .previous.next{text-align:right;margin-left:auto}.css-eyxei3 .next.previous,.css-eyxei3 .previous.previous{text-align:left}.css-eyxei3 .next .inner,.css-eyxei3 .previous .inner{-webkit-flex:1;-ms-flex:1;flex:1}</style><nav class=css-eyxei3><a class=previous href=/post/rebase_non_consecutive_commits><div class=arrow>❮</div><div class=inner><div class=title>떨어져 있는 커밋 합치기</div><div class=subtitle>의외로 간단한 git interactive rebase 활용법</div><div class=date>2023. 1. 10. 오후 2:32:23</div></div></a><a class=next href=/post/webpack_and_react_ssg_1><div class=inner><div class=title>Webpack과 React를 이용한 정적 웹사이트 만들기 (1)</div><div class=subtitle>Webpack + TypeScript + React + TailwindCSS = TA-DA!</div><div class=date>2023. 1. 10. 오후 2:00:48</div></div><div class=arrow>❯</div></a></nav></div></main><style data-emotion="css 19fp2wc">.css-19fp2wc{font-size:.75rem;line-height:.9rem}.css-19fp2wc p{margin:0 0 1em;padding:0}.css-19fp2wc .badges{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-19fp2wc .badges img{border-width:0;width:auto;height:3em}</style><footer class=css-19fp2wc><p>Copyright (C) 2020 ~ 2025 Yeonjin Shin (a.k.a. LiteHell), All rights reserved.<br><a href=/license>This blog is free software; For source code and more informations on license and copyrights, Click here.</a><p>Feeds: <a href=/feed/rss>RSS 2.0</a>, <a href=/feed/atom>Atom</a>, <a href=/feed/json>JSON</a><div class=badges><a href=http://creativecommons.org/licenses/by-sa/4.0/ rel=license><img alt="Creative Commons License"src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png><a href=https://www.gnu.org/licenses/agpl-3.0.en.html><img alt="GNU Affero General License Version 3"src=https://www.gnu.org/graphics/agplv3-with-text-100x42.png></a></a></div></footer></div>