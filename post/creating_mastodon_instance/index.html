<!doctypehtml><link href=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1 rel=icon><link href=https://blog.litehell.info/post/creating_mastodon_instance rel=canonical><link title="RSS 2.0 Feed for blog.litehell.info"href=https://blog.litehell.info/feed/rss rel=alternate type=application/rss+xml><link title="Atom 1.0 Feed for blog.litehell.info"type="	application/atom+xml"href=https://blog.litehell.info/feed/atom rel=alternate><link title="Json 1.0 Feed for blog.litehell.info"href=https://blog.litehell.info/feed/json rel=alternate type=application/feed+json><link href=https://esm.sh/@wooorm/starry-night@3/style/both rel=stylesheet><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href=https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap rel=stylesheet><meta content="LiteHell의 블로그 - Mastodon 서버 구축하기"property=og:title><meta content="6$짜리 VPS와 CloudFlare를 이용한 인스턴스 구축"property=og:description><meta content=ko_KR property=og:locale><meta content=blog property=og:type><meta content="LiteHell의 블로그"property=og:site_name><meta content=https://blog.litehell.info/post/creating_mastodon_instance property=og:url><meta content=https://blog.litehell.info/broken_css_mastodon.png property=og:image><meta content=width=device-width,initial-scale=1 name=viewport><style>html,body{margin:0;padding:0;font-family:Noto Sans KR,sans-serif}</style><title>LiteHell의 블로그 - Mastodon 서버 구축하기</title><body><link as=image href=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1 rel=preload><link as=image href=https://i.creativecommons.org/l/by-sa/4.0/88x31.png rel=preload><link as=image href=https://www.gnu.org/graphics/agplv3-with-text-100x42.png rel=preload><style data-emotion="css 1nfpw07">.css-1nfpw07{--top-padding:max(40px,3rem);--vertical-padding:max(20px,2em);padding:var(--top-padding)var(--vertical-padding)0em var(--vertical-padding);box-sizing:border-box;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;align-items:center;min-height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-1nfpw07>*{width:100%}@media (width>=1024px){.css-1nfpw07>*{max-width:960px}}.css-1nfpw07 main{-webkit-flex:1;-ms-flex:1;flex:1}.css-1nfpw07 footer{border-top:1px solid #727272;margin:2rem 0 0;padding:1.5rem 0}</style><div class=css-1nfpw07><style data-emotion="css 1choove">.css-1choove{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;align-items:center;gap:2rem;padding-bottom:1.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-1choove .profileImg a{color:inherit;-webkit-text-decoration:none;text-decoration:none}.css-1choove .profileImg img{border-radius:4rem;width:8rem;height:8rem;box-shadow:0 3px 6px #00000029,0 3px 6px #0000003b}.css-1choove .title h1{margin:0 0 .5rem;padding:0;font-size:2rem;line-height:2.5rem}.css-1choove .title h1 a{color:inherit;-webkit-text-decoration:none;text-decoration:none}.css-1choove .links{margin:0;padding:0;font-size:.9rem;line-height:1.2rem}@media (width<=1023px){.css-1choove .title h1{font-size:1.5rem;line-height:2rem}.css-1choove .rounded img{border-radius:3.5rem 3.4rem;width:7rem;height:7rem}}</style><header class=css-1choove><div class=profileImg><a href=/><img alt="LiteHell의 Gravatar 아이콘"src=https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1></a></div><div class=title><h1><a href=/>LiteHell의 블로그</a></h1><p class=links>외부고리: <a href=https://github.com/litehell>GitHub</a>, <a href=https://yeonjin.name/portfolio>Portfolio</a><br>내부고리: <a href=/categories>카테고리</a>, <a href=/tags>태그</a></div></header><main><div><style data-emotion="css 1v4sk1e">.css-1v4sk1e{border-bottom:1px solid #999;margin-bottom:.8rem;padding:1.5rem 0 2rem}.css-1v4sk1e .title{margin-bottom:.25rem}.css-1v4sk1e .title *{margin:0;padding:0;display:inline}.css-1v4sk1e .title h2{font-size:2rem;line-height:2.1rem}.css-1v4sk1e .title h3{margin-left:1rem;font-size:1rem;font-weight:200;line-height:1rem}.css-1v4sk1e .datetime{color:#666;margin:0;padding:0}.css-1v4sk1e .links .description{color:#666}</style><div class=css-1v4sk1e><div class=title><h2>Mastodon 서버 구축하기</h2><h3>6$짜리 VPS와 CloudFlare를 이용한 인스턴스 구축</h3></div><p class=datetime>2023. 7. 22. 오후 3:55:38에 LiteHell이(가) 편집함.<div class=links><div class=link><span class=description>카테고리: </span><a href=/category/Dev>Dev</a></div><div class=link><span class=description>테그: </span><a href=/tag/Mastodon>Mastodon</a>, <a href=/tag/ActivityPub>ActivityPub</a></div></div></div><style data-emotion="css vj6hh8">.css-vj6hh8{padding:10px;font-size:1rem;line-height:180%}.css-vj6hh8 pre{overflow-x:auto}.css-vj6hh8 h1{margin:1.8rem 0;font-size:1.8rem}.css-vj6hh8 h1:before{content:"# ";color:#a19c91}.css-vj6hh8 h2{margin:1.6rem 0;font-size:1.6rem}.css-vj6hh8 h2:before{content:"## ";color:#a19c91}.css-vj6hh8 h3{margin:1.4rem 0;font-size:1.4rem}.css-vj6hh8 h3:before{content:"### ";color:#a19c91}.css-vj6hh8 h4{margin:1.2rem 0;font-size:1.2rem}.css-vj6hh8 h5{margin:1.15rem 0;font-size:1.15rem}.css-vj6hh8 h5:before{content:"> ";color:#a19c91}.css-vj6hh8 h6{margin:1.1rem 0;font-size:1.1rem}.css-vj6hh8 h6:before{content:">> ";color:#a19c91}.css-vj6hh8 img,.css-vj6hh8 iframe{max-width:80%;margin:0 auto;display:block}.css-vj6hh8 table{white-space:nowrap;border-collapse:collapse;display:block;overflow-x:auto}.css-vj6hh8 table td,.css-vj6hh8 table tr,.css-vj6hh8 table th{border:1px solid gray}.css-vj6hh8 table th{font-weight:700}.css-vj6hh8 table th,.css-vj6hh8 table td{padding:5px 10px}.css-vj6hh8 table thead{background:#d8d8d8}.css-vj6hh8 blockquote{background:#c2c2c2;border-left:5px solid #4e4e4e;margin:25px 10px 25px 30px;padding:10px 50px}.css-vj6hh8 ul li,.css-vj6hh8 ol li{margin:6px 0}</style><article class=css-vj6hh8><h1>트위터와 페디버스</h1><p>확실히 요즘 트위터는 달라졌다. 일론 머스크가 인수한 이후의 트위터는 확실히 뭔가 달라졌다. 뭔가 보여주겠다는 의지의 표출인가?<p>이런 새로워진 트위터에 적응하지 못한 사람들은 <a href=https://joinmastodon.org>마스토돈</a>이나 <a href=https://misskey-hub.net/>미스키</a> 등의 <a href=https://www.w3.org/TR/activitypub/>ActivityPub</a>를 구현한 분산형 SNS 인스턴스로 이주하고 있다. 국내의 이런 분산형 SNS는 대표적으로 다음과 같다.<ul><li><a href=https://twingyeo.kr/>트잉여</a><li><a href=https://planet.moe/>플래닛</a><li><a href=https://qdon.space/>큐돈</a><li><a href=https://ani.work/>애니워크</a><li><a href=https://social.silicon.moe>SifNet Mastodon</a><li><a href=https://hoto.moe>hotomoe</a></ul><p>위와 같이 서로 AcitivtyPub 등의 프로토콜을 이용해 통신하는 SNS 서비스들의 집합을 <strong>Fediverse</strong>(페디버스)라 일컬는다. 페디버스는 서버간에 서로 통신할 수 있기 때문에 다른 서버에 있는 사용자와도 소통할 수 있다. 즉, 서버 A에서 서버 B에 있는 사람을 팔로우할 수도 있다.<h1>Mastodon 설치</h1><p>분산형 SNS이니 당연히 본인이 직접 서버를 구축하는 것도 가능하다. 따라서 직접 VPS에 마스토돈을 설치했다. VPS 운영체제로는 데비안을 택했고, 사양은 Vultr $6 VPS로 했다.<p>설치 자체는 <a href=https://docs.joinmastodon.org/admin/install/>공식 홈페이지의 문서</a>를 따르는 식으로 진행했으나 중간중간 삽질을 약간 했다.<h2>root 계정 전환</h2><p>마스토돈을 설치하기 위해서는 먼저 root 계정으로 전환한다. <code>su</code> 명령어를 이용하면 된다.<h2>의존성 설치</h2><p>그 다음, 의존성을 설치해야 한다. 의존성 설치 자체는 공식 홈페이지에 있는 명령어를 복사-붙여넣기하면 끝난다.<p>첫번째로 다음 명령어를 실행해 node.js v16을 설치한다.<pre><code class=language-bash>curl -sL https://deb.nodesource.com/setup_16.x <span class=pl-k>|</span> bash -
</code></pre><p>그리고 다음 명령어를 실행해 PostgreSQL와 기타 다른 의존성들을 설치한다.<pre><code class=language-bash>apt install -y curl wget gnupg apt-transport-https lsb-release ca-certificates
wget -O /usr/share/keyrings/postgresql.asc https://www.postgresql.org/media/keys/ACCC4CF8.asc
<span class=pl-c1>echo</span> <span class=pl-s><span class=pl-pds>"</span>deb [signed-by=/usr/share/keyrings/postgresql.asc] http://apt.postgresql.org/pub/repos/apt <span class=pl-pds>$(</span>lsb_release -cs<span class=pl-pds>)</span>-pgdg main<span class=pl-pds>"</span></span> <span class=pl-k>></span> /etc/apt/sources.list.d/postgresql.list
apt update
apt install -y \
  imagemagick ffmpeg libpq-dev libxml2-dev libxslt1-dev file git-core \
  g++ libprotobuf-dev protobuf-compiler pkg-config nodejs gcc autoconf \
  bison build-essential libssl-dev libyaml-dev libreadline6-dev \
  zlib1g-dev libncurses5-dev libffi-dev libgdbm-dev \
  nginx redis-server redis-tools postgresql postgresql-contrib \
  certbot python3-certbot-nginx libidn11-dev libicu-dev libjemalloc-dev
</code></pre><h3>nodejs 버전 확인</h3><p>다만 여기서 주의해야 하는 것이 있다. 시스템에 따라서 nodejs 16버전이 아닌 그보다 더 최신 버전이 설치됐었을 수도 있다. 상관없지 않냐고? 상관있다, nodejs v16 버전이 아니면 나중에 webpack precompile 과정에서 오류가 난다.<p>설치된 nodejs의 버전은 <code>node --version</code> 명령어로 확인할 수 있다.<pre><code class=language-bash>$ node --version
v18.13.0
</code></pre><p>이는 데비안 apt 레포지토리에 있는 <code>nodejs</code> 패키지 버전이 16보다 더 최신이기 때문에 발생한 문제이다. 이를 해결하기 위해서는 먼저 <code>sudo apt-cache policy nodejs</code>를 실행해 어떤 버전이 설치 가능한지 확인해야 한다.<pre><code class=language-bash>$ sudo apt-cache policy nodejs
nodejs:
  Installed: 18.13.0+dfsg1-1
  Candidate: 18.13.0+dfsg1-1
  Version table:
 <span class=pl-k>***</span> 18.13.0+dfsg1-1 500
        500 https://deb.debian.org/debian bookworm/main amd64 Packages
        500 https://debian.mirror.constant.com bookworm/main amd64 Packages
     16.20.1-deb-1nodesource1 500
        500 https://deb.nodesource.com/node_16.x bookworm/main amd64 Packages
        100 /var/lib/dpkg/status
</code></pre><p>위 예시에서는 <code>18.13.0+dfsg1-1</code>과 <code>16.20.1-deb-1nodesource1</code> 버전이 설치 가능하다. 우리가 필요한 것은 nodejs v16대 버전이니 <code>16.20.1-deb-1nodesource1</code>을 설치할 것이다.<p>apt에서 특정한 버전을 지정해 설치하기 위해서는 다음과 같이 명령어를 실행하면 된다.<pre><code class=language-bash>$ sudo apt install nodejs=16.20.1-deb-1nodesource1
</code></pre><p>그러면 nodejs v16이 정상적으로 설치된 것을 확인할 수 있다.<h3>Yarn 설치</h3><p>위에서 nodejs, PostregreSQL 등의 의존성을 다 설치했으면 <a href=https://yarnpkg.com>Yarn</a>을 설치해야 한다. Yarn은 다음 명령어로 설치한다.<pre><code class=language-bash>corepack <span class=pl-c1>enable</span>
yarn <span class=pl-c1>set</span> version classic
</code></pre><p>혹시 위 명령어가 작동하지 않는다면 다음과 같이 npm을 이용해 설치할 수도 있다.<pre><code class=language-bash>sudo npm i -g yarn
</code></pre><p>만약 위 npm을 이용한 명령어가 npm이 설치되어 있지 않아 실행되지 않는다면 아래 명령어로 npm을 실치할 수 있다.<pre><code class=language-bash>curl -qL https://www.npmjs.com/install.sh <span class=pl-k>|</span> sh
</code></pre><h2>Ruby 설치</h2><p>이제 Ruby를 설치해야 한다. 먼저 <code>mastodon</code>이라는 이름의 리눅스 계정을 생성한다.<pre><code class=language-bash>adduser --disabled-login mastodon
</code></pre><p>그리고 쉘을 지정한다. (안 하면 <code>sudo su - mastodon</code> 명령어가 오류날 수 있다.) 아래 명령어에서는 쉘을 bash로 지정했는데, 쉘이 무조건 bash여야 할 필요는 없다. 선호하는 쉘이 있다면 그 쉘로 지정해도 된다.<pre><code class=language-bash>chsh -s /bin/bash mastodon
</code></pre><p>이제 mastodon으로 계정을 전환하자.<pre><code class=language-bash>sudo su - mastodon
</code></pre><p>다음 명령어를 모두 실행해 Ruby를 설치한다.<pre><code class=language-bash>git clone https://github.com/rbenv/rbenv.git <span class=pl-k>~</span>/.rbenv
<span class=pl-c1>cd</span> <span class=pl-k>~</span>/.rbenv <span class=pl-k>&&</span> src/configure <span class=pl-k>&&</span> make -C src
<span class=pl-c1>echo</span> <span class=pl-s><span class=pl-pds>'</span>export PATH="$HOME/.rbenv/bin:$PATH"<span class=pl-pds>'</span></span> <span class=pl-k>>></span> <span class=pl-k>~</span>/.bashrc
<span class=pl-c1>echo</span> <span class=pl-s><span class=pl-pds>'</span>eval "$(rbenv init -)"<span class=pl-pds>'</span></span> <span class=pl-k>>></span> <span class=pl-k>~</span>/.bashrc
<span class=pl-c1>exec</span> bash
git clone https://github.com/rbenv/ruby-build.git <span class=pl-k>~</span>/.rbenv/plugins/ruby-build
RUBY_CONFIGURE_OPTS=--with-jemalloc rbenv install 3.0.6
rbenv global 3.0.6
</code></pre><p>Ruby 설치가 완료됐다면 bundler도 설치한다.<pre><code class=language-bash>gem install bundler --no-document
</code></pre><p>Ruby와 bundler 설치를 마쳤다면 root 유저로 되돌아간다.<pre><code class=language-bash><span class=pl-c1>exit</span>
</code></pre><h2>PostgreSQL 설정</h2><p>공식 문서에서 pgTune을 쓰고 싶으면 쓰라고 나와있는데 필자는 귀찮아서 건너뛰었다.<p>PostgreSQL 설정을 위해 다음 명령어로 PostgreSQL 쉘을 띄운다.<pre><code class=language-bash>sudo -u postgres psql
</code></pre><p>PostgreSQL 쉘이 띄워졌으면 다음 쿼리를 실행해서 SQL 계정을 생성한다.<pre><code class=language-sql><span class=pl-k>CREATE</span> <span class=pl-k>USER</span> <span class=pl-en>mastodon</span> CREATEDB;
</code></pre><p>계정이 생성됐으면 다음 명령을 쳐서 쉘을 빠져나온다.<pre><code class=language-sql>\q
</code></pre><h2>마스토돈 다운로드</h2><p>이제 마스토돈을 다운로드하고 설정할 때가 왔다. 먼저 mastodon 계정으로 전환한다.<pre><code class=language-bash>sudo su - mastodon
</code></pre><p>다음 명령어를 실행해 최신 stable 버전의 mastodon을 다운로드한다.<pre><code class=language-bash>git clone https://github.com/mastodon/mastodon.git live <span class=pl-k>&&</span> <span class=pl-c1>cd</span> live
git checkout <span class=pl-s><span class=pl-pds>$(</span>git tag -l <span class=pl-k>|</span> grep -v <span class=pl-pds>'</span>rc[0-9]*$<span class=pl-pds>'</span> <span class=pl-k>|</span> sort -V <span class=pl-k>|</span> tail -n 1<span class=pl-pds>)</span></span>
</code></pre><p>이제 Ruby 의존성과 JavaScript 의존성을 설치한다.<pre><code class=language-bash>bundle config deployment <span class=pl-s><span class=pl-pds>'</span>true<span class=pl-pds>'</span></span>
bundle config without <span class=pl-s><span class=pl-pds>'</span>development test<span class=pl-pds>'</span></span>
bundle install -j<span class=pl-s><span class=pl-pds>$(</span>getconf _NPROCESSORS_ONLN<span class=pl-pds>)</span></span>
yarn install --pure-lockfile
</code></pre><h2>서버 swap 설정 및 nodejs heap 용량 설정</h2><p>마스토돈 설정(바로 다음 문단)을 하는 과정에서 Javascript heap out of memory 오류가 발생할 수 있다. 이는 서버에 RAM이 부족하기 때문이다. 이를 해결하기 위해서는 RAM을 더 꽂거나 swap 파일을 형성하고, 그 다음 node 설정을 수정해야 한다.<p>먼저 swap파일을 생성하는 방법은 다음과 같다. 용량은 적절하게 바꾸면 된다.<pre><code class=language-bash>sudo fallocate -l 2G /tmp-swapfile
sudo chmod 600 /tmp-swapfile
sudo mkswap /tmp-swapfile
</code></pre><p>생성된 swap파일은 다음과 같이 적용할 수 있다.<pre><code class=language-bash>sudo swapon /tmp-swapfile
</code></pre><p>위 명령어로 적용된 swap파일은 재부팅이 될 시 다시 적용되지 않으므로 재부팅을 하면 위 명령어를 다시 쳐줘야 한다. 따라서 swap 파일을 영구적으로 적용하기 위해서는 <code>/etc/fstab</code> 파일을 수정해야 하나, 본 글에서는 마스토돈을 설정하는 동안에만 임시적으로 이용할 swap 파일을 생성하는 것이므로 이 파일을 수정하는 방법에 대해서 언급하지 않는다.<p>이제 node 설정을 바꾸어야 한다. 먼저 현재 할당한 힙 용량을 다음 명령어로 확인한다.<pre><code class=language-bash>node -e <span class=pl-s><span class=pl-pds>'</span>console.log(v8.getHeapStatistics().heap_size_limit/(1024*1024))<span class=pl-pds>'</span></span>
</code></pre><p>실행하면 다음과 같이 뜰 것이다.<pre><code class=language-bash>$ node -e <span class=pl-s><span class=pl-pds>'</span>console.log(v8.getHeapStatistics().heap_size_limit/(1024*1024))<span class=pl-pds>'</span></span>
495.75
</code></pre><p>위 용량을 참고해서 위 용량보다 적당히 더 큰 용량으로 힙 용량을 설정하면 된다. 힙 용량의 설정은 다음 명령어를 마스토돈 설정 명령어 실행 직전에 실행함으로써 할 수 있다.<pre><code class=language-bash><span class=pl-k>export</span> NODE_OPTIONS=--max_old_space_size=800
</code></pre><h2>마스토돈 설정</h2><p>다음 명령어를 실행해 마스토돈 서버를 설정한다.<pre><code class=language-bash>RAILS_ENV=production bundle <span class=pl-c1>exec</span> rake mastodon:setup
</code></pre><p>만약 Javascript heap out of memory 오류가 떴다면 바로 윗 문단에 따라 힙 용량 및 swap 설정을 하고 다음 명령어를 실행하면 된다.<pre><code class=language-bash>RAILS_ENV=production bundle <span class=pl-c1>exec</span> rails assets:precompile
</code></pre><p>성공적으로 실행됐을 시 마스토돈 관리자 비밀번호가 표시될 것이다. 잊지 말고 메모하도록 하자.<h2>nginx 설정</h2><p>다음 명령어를 실행한다.<pre><code class=language-bash>cp /home/mastodon/live/dist/nginx.conf /etc/nginx/sites-available/mastodon
ln -s /etc/nginx/sites-available/mastodon /etc/nginx/sites-enabled/mastodon
</code></pre><p><code>/etc/nginx/sites-available/mastodon</code> 파일에서 <code>example.com</code>을 모두 자신의 마스토돈 도메인(내 경우에는 <code>social.litehell.info</code>)로 바꾼다. 그리고 다음 명령어를 실행한다.<pre><code class=language-bash>systemctl reload nginx
</code></pre><h2>CloudFlare Origin Certificate 설정</h2><p>필자는 CloudFlare Origin Certificate를 쓴다. CloudFlare에서 Origin Certificate를 생성한 뒤 서버에 저장하고, <code>/etc/nginx/sites-available/mastodon</code> 파일에서 <code>ssl_certificate</code> 속성과 <code>ssl_certificate_key</code>를 다운받은 서버/서버 개인키 경로로 수정하면 된다.<h2>systemd 설정</h2><p>아래 명령어를 실행한다.<pre><code class=language-bash>cp /home/mastodon/live/dist/mastodon-<span class=pl-k>*</span>.service /etc/systemd/system/
systemctl daemon-reload
systemctl <span class=pl-c1>enable</span> --now mastodon-web mastodon-sidekiq mastodon-streaming

</code></pre><p>그러면 마스토돈이 실행될 것이다. 이제 즐기면 된다.<h2>CloudFlare 최적화로 인한 사이트 깨짐 문제 해결</h2><p><img alt="CSS가 정상적으로 불러와지지 않은 마스토돈 인스턴스의 스크린샷"src=./broken_css_mastodon.png><p>CloudFlare를 쓰면 위와 같이 마스토돈이 깨지는 문제를 겪을 수 있다. 이는, 무결성을 위해 HTML 내에 CSS 파일의 해시가 포함되어있는데, CloudFlare가 CSS를 자동 최적화하면서 CSS 파일이 변경되고, 이로 인해 해시가 불일치됨에 따라 웹브라우저가 CSS를 불러오지 않음으로써 발생하는 문제이다.<p>이 문제는 CloudFlare에서 Auto Minify를 비활성화하고 모든 캐시를 삭제하여 해결할 수 있다.<h2>릴레이 연결</h2><p>마스토돈에 혼자 있으면 외롭다. 이를 극복하기 위해서는 릴레이를 연결해야 한다. 페디버스 내에서 인스턴스는 기본적으로 게시물을 팔로워가 있는 서버에만 전송한다. 따라서 타 서버의 팔로워가 없는 인스턴스는 외로울 수 밖에 없다. 이를 극복하기 위해 릴레이가 있다.<p>릴레이는 구독하는 서버들간에 게시물을 나눈다. 릴레이에 구독된 인스턴스가 게시물을 릴레이로 보내면, 릴레이가 구독된 모든 서버들에게 게시물을 전송하는 방식이다. 따라서 릴레이내에 있는 서버간에는 팔로워가 있는지의 여부와 상관없이 게시물이 서로 공유된다.<p>한국어권 릴레이는 다음 세가지 릴레이가 있다. 이 릴레이는 모두 화이트리스트이다.<ul><li><a href=https://relay.mastodon.kr>한국 Mastodon 인스턴스 연합(가칭) 릴레이</a><li><a href=https://interstellar.flights>인터스텔라 릴레이 커뮤니티</a><li><a href=https://relay.musubi.moe>musubi.moe</a></ul><p>위 릴레이에 가입하기 위해서는 각 릴레이에서 요구하는 조건을 모두 만족시킨 뒤 릴레이측에 가입 신청을 하면 된다. 가입 신청 방법 및 조건은 릴레이마다 다르다. 가입 신청이 받아들여지면 릴레이 관리 페이지(<code>/admin/relays</code>)에서 해당 릴레이에서 안내하는 주소를 추가하면 된다. 참고로 내 경험상 개인 인스턴스라고 딱히 안 받아주진 않았다. 조건만 맞으면 받아주는 것 같으니 조건이 맞는다면 부담없이 신청해보자.<p>모든 릴레이가 화이트리스트인 것은 아니다. <a href=https://relaylist.com>RelayList</a>에서 Registeration이 open으로 되어있는 릴레이는 가입신청을 하지 않아도 되는 릴레이들이다. 다만 대규모 릴레이는 구독이 처리되는 데 시간이 좀 오래 걸릴 수 있다.<p><a href=https://relay.fedi.buzz/>#FediBuzz Relay</a> 서비스를 이용하면 특정 마스토돈 인스턴스의 타임라인을 릴레이를 통해 구독할 수도 있다. 해당 사이트의 안내를 따르면 특정 인스턴스의 타임라인을 구독할 수 있다.<h2>public/system 용량 문제</h2><p><code>public/system</code> 디렉토리는 용량을 많이 잡아먹는다. 다음 두 가지 방법 중 하나를 택하여 해결하면 된다.<ul><li>S3-Compatible Object Storage 쓰기<li><a href=https://docs.joinmastodon.org/admin/setup/#cleanup>마스토돈 공식 홈페이지의 Running periodic cleanup tasks 문단</a>에 따라 crontab을 생성하고 마스토돈이 설치된 디렉토리에서 다음 명령어 모두 실행하기 <pre><code class=language-bash></code></pre></ul><p>RAILS_ENV=production ./bin/tootctl accounts prune RAILS_ENV=production ./bin/tootctl cache clear RAILS_ENV=production ./bin/tootctl media remove --days=0 RAILS_ENV=production ./bin/tootctl media remove --prune-profiles --days=0 RAILS_ENV=production ./bin/tootctl preview_cards remove --days=0<pre><code>- crontab과 위 명령어만으로 부족하면 그냥 대용량 하드디스크 하나 꽂고 `/etc/fstab` 파일 수정해서 `public/system` 디렉토리에 영구 마운트해버리기 (좀 무식하게 보일 수도 있지만 간단하고 직빵이다)

마음에 드는 방법을 택하도록 하자.
</code></pre></article><style data-emotion="css 1ko3mci">.css-1ko3mci{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;justify-content:space-between;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-1ko3mci a{-webkit-text-decoration:none;text-decoration:none}.css-1ko3mci .inner{vertical-align:top;display:inline-block}.css-1ko3mci .inner .title{font-size:1.3em}.css-1ko3mci .inner .subtitle{font-weight:200}.css-1ko3mci .inner .date{font-size:.8em;font-weight:200}.css-1ko3mci .next:after{content:" ❯";font-size:1.25em}.css-1ko3mci .previous:before{content:"❮ ";font-size:1.25em}</style><nav class=css-1ko3mci><a class=previous href=/post/webpack_and_react_ssg_3><div class=inner><div class=title>Webpack과 React를 이용한 정적 웹사이트 만들기 (3)</div><div class=subtitle>... + MiniCssExtractPlugin = TA-DA!</div><div class=date>2023. 7. 23. 오후 5:25:47</div></div></a><a class=next href=/post/min_max_heap><div class=inner><div class=title>최소-최대 힙(Min-max heap) 구현하기 (백준 7662번 이중 우선순위 큐 문제)</div><div class=subtitle>최소값과 최대값을 동시에 구할 수 있는 힙 자료구조</div><div class=date>2023. 5. 3. 오후 3:24:12</div></div></a></nav></div></main><style data-emotion="css 19fp2wc">.css-19fp2wc{font-size:.75rem;line-height:.9rem}.css-19fp2wc p{margin:0 0 1em;padding:0}.css-19fp2wc .badges{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.css-19fp2wc .badges img{border-width:0;width:auto;height:3em}</style><footer class=css-19fp2wc><p>Copyright (C) 2020 ~ 2025 Yeonjin Shin (a.k.a. LiteHell), All rights reserved.<br><a href=/license>This blog is free software; For source code and more informations on license and copyrights, Click here.</a><p>Feeds: <a href=/feed/rss>RSS 2.0</a>, <a href=/feed/atom>Atom</a>, <a href=/feed/json>JSON</a><div class=badges><a href=http://creativecommons.org/licenses/by-sa/4.0/ rel=license><img alt="Creative Commons License"src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png><a href=https://www.gnu.org/licenses/agpl-3.0.en.html><img alt="GNU Affero General License Version 3"src=https://www.gnu.org/graphics/agplv3-with-text-100x42.png></a></a></div></footer></div>