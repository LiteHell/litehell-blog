<!DOCTYPE html><html lang="ko-KR"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1"/><link rel="canonical" href="https://blog.litehell.info/post/docker_for_testing"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0 Feed for blog.litehell.info" href="https://blog.litehell.info/feed/rss"/><link rel="alternate" type=" application/atom+xml" title="Atom 1.0 Feed for blog.litehell.info" href="https://blog.litehell.info/feed/atom"/><link rel="alternate" type="application/feed+json" title="Json 1.0 Feed for blog.litehell.info" href="https://blog.litehell.info/feed/json"/><meta property="og:title" content="Docker로 테스트하기"/><meta property="og:description" content="Docker로 빌드만 하지 말고 테스트도 하자"/><meta property="og:locale" content="ko_KR"/><meta property="og:type" content="article"/><meta property="og:site_name" content="LiteHell의 블로그"/><meta property="og:url" content="https://blog.litehell.info/post/docker_for_testing"/><meta property="og:image" content="https://gravatar.com/avatar/837266b567b50fd59e72428220bf69b1"/><title>LiteHell의 블로그 - <!-- -->Docker로 테스트하기</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs2015.min.css"/><meta name="next-head-count" content="16"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CZL0E8YDPW"></script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5916984077364289" crossorigin="anonymous"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-CZL0E8YDPW', { page_path: window.location.pathname });
            </script><link rel="preload" href="/_next/static/css/27d177a30947857b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/27d177a30947857b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/088d29430e0ecbdb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/088d29430e0ecbdb.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-ad45764ecfcae9e5.js" defer=""></script><script src="/_next/static/chunks/main-ee0cf4b7f81d7c24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a96cacb95f41a3ef.js" defer=""></script><script src="/_next/static/chunks/996-c5e5aa4c30f33066.js" defer=""></script><script src="/_next/static/chunks/503-25bfb158f613fce4.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bid%5D-b722ca2857677f7b.js" defer=""></script><script src="/_next/static/awhFjBdq9zgQaqX8Z7gzv/_buildManifest.js" defer=""></script><script src="/_next/static/awhFjBdq9zgQaqX8Z7gzv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_body__O2_kC"><header class="Layout_header__M_IZ8"><div class="Layout_container__z4qWC"><h1><a href="/">LiteHell의 블로그</a></h1><div class="Layout_outLinks__XBNs_">외부고리 : <a href="https://litehell.info">Homepage</a><a href="https://github.com/LiteHell">GitHub</a><a href="https://linkedin.com/in/LiteHell">LinkedIn</a><a href="https://keybase.io/LiteHell">Keybase</a><a href="mailto:litehell@litehell.info">Email</a></div><div class="Layout_inLinks__f7gmD">내부고리 : <a href="/category">카테고리</a><a href="/tag">태그</a></div></div></header><main class="Layout_mainContainer__5WZfx"><div class="Layout_container__z4qWC"><div class="Blog_header__r4wcZ"><div class="Blog_title___OFu6"><h1>Docker로 테스트하기</h1><h2>Docker로 빌드만 하지 말고 테스트도 하자</h2></div><p>10/25/2023, 2:49:49 PM<!-- -->에 <!-- -->LiteHell<!-- -->이(가) 작성<!-- -->함<br/><span>카테고리 : <a href="/category/Dev">Dev</a><br/></span><span>태그 : <span class="Blog_tag__RW5VK"><a href="/tag/Docker">Docker</a></span><br/></span></p></div><section class="Blog_article__WZp3G"><h1 id="들어가는-글">들어가는 글</h1>
<p>필자는 중앙대학교 공지사항을 <a href="https://rss.puang.network">RSS</a>로 만들어서 구독한다. RSS로 만든 후 메신지 봇을 붙이면 알아서 알려주니 편하다.</p>
<p>그러나 최근 해당 RSS 프로그램의 테스트가 실패하는 현상이 발견됐다. 확인한 결과, <a href="https://swedu.cau.ac.kr">중앙대학교 SW교육원</a> 홈페이지의 TLS 인증서 이슈였던 것으로 확인됐다. 따라서 이를 해결하기 위해 일단 실행되고 있는 Docker 컨테이너에 직접 접근해서 해당 사이트의 CA 인증서를 설치했다.</p>
<h1 id="기존-테스트-방법의-한계점">기존 테스트 방법의 한계점</h1>
<p>버그는 일단 임시방편으로 수정한 것이니 레포에는 반영되지 않았다. 따라서 테스트 실패 메일이 매일매일 내 메일함으로 전송됐다.</p>
<p>어떻게 하면 이 버그를 수정하고 잘 테스트할 수 있을까? 먼저 이 버그를 수정하려면 Dockerfile을 수정해야 한다. Dockerfile에 다음 내용을 추가하여 Docker 이미지 빌드시 CA 인증서를 복사하도록 했다. <a href="https://github.com/LiteHell/cau-rss/commit/d765d53d61e9370f5a284068ed273570d21013a3">LiteHell/cau-rss 레포의 커밋 21013a3</a>에서 확인할 수 있다.</p>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">COPY</span><span class="bash"> swedu-cert.pem /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/swedu-cert.crt</span>
<span class="hljs-keyword">RUN</span><span class="bash"> cat /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/swedu-cert.crt &gt;&gt; /etc/ssl/certs/ca-certificates.crt</span></code></pre>
<p>이제 위 버그 수정도 같이 테스트해야 한다. 아래에 있는 기존의 GitHub Action으로는 이 버그 수정을 테스트할 수 없다. <code>go test -v ./...</code> 명령어가 빌드된 Docker 이미지 내에서 실행되는 것이 아니기 때문이다.</p>
<pre><code class="hljs language-yaml">      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">go</span> <span class="hljs-string">build</span> <span class="hljs-string">-v</span> <span class="hljs-string">./...</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Test</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">go</span> <span class="hljs-string">test</span> <span class="hljs-string">-v</span> <span class="hljs-string">./...</span></code></pre>
<p>어떻게 하면 테스트할 수 있을까? 답은 간단하다. Docker로 테스트도 하면 된다.</p>
<h1 id="docker를-이용한-테스트">Docker를 이용한 테스트</h1>
<h2 id="multi-stage-빌드">Multi-stage 빌드</h2>
<p>Docker는 빌드를 여러 단계로 나누어 진행할 수 있다. 아래 예시 Dockerfile을 보자.</p>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">FROM</span> node AS base
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">ADD</span><span class="bash"> src package.json package-lock.json tsconfig.json .</span>

<span class="hljs-keyword">RUN</span><span class="bash"> npm i</span>
<span class="hljs-keyword">RUN</span><span class="bash"> npm bulid</span>

<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>]</span></code></pre>
<p>Typescript 프로젝트를 위한 간단한 Dockerfile이다. 이를 다음과 같이 여러개의 단계(stage)로 쪼갤 수 있다.</p>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">FROM</span> node AS base
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">ADD</span><span class="bash"> src package.json package-lock.json tsconfig.json .</span>

<span class="hljs-keyword">FROM</span> base AS deps
<span class="hljs-keyword">RUN</span><span class="bash"> npm i</span>

<span class="hljs-keyword">FROM</span> deps AS build
<span class="hljs-keyword">RUN</span><span class="bash"> npm bulid</span>

<span class="hljs-keyword">FROM</span> build As deployment
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>]</span>
</code></pre>
<p>위와 같은 Dockerfile을 이용하면 Docker 빌드시 특정 스테이지까지만 빌드할 수 있다. 예를 들어 아래 명령어는 deps 스테이지까지만 빌드한다.</p>
<pre><code class="hljs language-bash">docker build --target deps</code></pre>
<p>스테이지가 직선적이여야 할 필요는 없다. 다음과 같이 스테이지가 중간에 분기하도록 작성할 수도 있다.</p>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">FROM</span> node AS base
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">ADD</span><span class="bash"> src package.json package-lock.json tsconfig.json .</span>

<span class="hljs-keyword">FROM</span> base AS deps
<span class="hljs-keyword">RUN</span><span class="bash"> npm i</span>

<span class="hljs-keyword">FROM</span> deps AS build
<span class="hljs-keyword">RUN</span><span class="bash"> npm bulid</span>

<span class="hljs-keyword">FROM</span> build As english
<span class="hljs-keyword">COPY</span><span class="bash"> english .</span>

<span class="hljs-keyword">FROM</span> english As deployment-international
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>, <span class="hljs-string">&quot;--lang=english&quot;</span>]</span>

<span class="hljs-keyword">FROM</span> build As korean
<span class="hljs-keyword">COPY</span><span class="bash"> korean .</span>

<span class="hljs-keyword">FROM</span> korean AS deployment-domestic
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>, <span class="hljs-string">&quot;--lang=korean&quot;</span>]</span></code></pre>
<p>위 Dockerfile의 경우 build 스테이지에서 english 스테이지와 korean 스테이지로 분기한다.</p>
<h3 id="buildkit">BuildKit</h3>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">FROM</span> node AS base
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">ADD</span><span class="bash"> src package.json package-lock.json tsconfig.json .</span>

<span class="hljs-keyword">FROM</span> base AS deps
<span class="hljs-keyword">RUN</span><span class="bash"> npm i</span>

<span class="hljs-keyword">FROM</span> deps AS build
<span class="hljs-keyword">RUN</span><span class="bash"> npm bulid</span>

<span class="hljs-keyword">FROM</span> build As english
<span class="hljs-keyword">COPY</span><span class="bash"> english .</span>

<span class="hljs-keyword">FROM</span> english As deployment-international
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>, <span class="hljs-string">&quot;--lang=english&quot;</span>]</span>

<span class="hljs-keyword">FROM</span> build As korean
<span class="hljs-keyword">COPY</span><span class="bash"> korean .</span>

<span class="hljs-keyword">FROM</span> korean AS deployment-domestic
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>, <span class="hljs-string">&quot;--lang=korean&quot;</span>]</span></code></pre>
<p>위 Dockerfile을 가지고 아래 명령어를 실행한다고 가정해보자.</p>
<pre><code class="hljs language-bash">docker build --target deployment-domestic</code></pre>
<p>위 경우 빌드에 필요한 스테이지는 <code>base</code>, <code>deps</code>, <code>build</code>, <code>korean</code>, <code>deployment-domestic</code>이다. 그러나 실제로 위 명령어를 실행해보면 불필요한 <code>english</code>, <code>deployment-international</code> 스테이지도 빌드하는 것을 확인할 수 있다.</p>
<p>이는 도커 레거시 빌더를 이용하기 때문에 생기는 문제이다. <a href="https://docs.docker.com/build/buildkit/">Docker BuildKit</a>은 사용되지 않는 스테이지를 자동으로 파악하여 불필요한 스테이지는 빌드를 생략한다. 따라서 Docker BuildKit을 설치한 후 다음 명령어로 빌드하면 필요한 스테이지만 빌드할 수 있다.</p>
<pre><code class="hljs language-bash">DOCKER_BUILDKIT=1 docker build --target deployment-domestic</code></pre>
<h2 id="multi-stage-빌드를-이용한-테스트">Multi-stage 빌드를 이용한 테스트</h2>
<p>이제 Docker를 이용해 테스트를 하는 방법에 대해 알아보자. 다음은 <a href="https://github.com/LiteHell/cau-rss">cau-rss 레포</a>의 Dockerfile 내용을 약간 수정한 예시이다.</p>
<pre><code class="hljs language-Dockerfile"><span class="hljs-keyword">FROM</span> golang:alpine as base
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>

<span class="hljs-keyword">COPY</span><span class="bash"> go.mod go.sum ./</span>
<span class="hljs-keyword">RUN</span><span class="bash"> go mod download &amp;&amp; go mod verify</span>

<span class="hljs-keyword">COPY</span><span class="bash"> cau_parser ./cau_parser</span>
<span class="hljs-keyword">COPY</span><span class="bash"> server ./server</span>

<span class="hljs-comment"># To avoid tls error from swedu.cau.ac.kr</span>
<span class="hljs-keyword">COPY</span><span class="bash"> swedu-cert.pem /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/swedu-cert.crt</span>
<span class="hljs-keyword">RUN</span><span class="bash"> cat /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/swedu-cert.crt &gt;&gt; /etc/ssl/certs/ca-certificates.crt</span>

<span class="hljs-keyword">COPY</span><span class="bash"> static ./static</span>
<span class="hljs-keyword">COPY</span><span class="bash"> html ./html</span>

<span class="hljs-keyword">COPY</span><span class="bash"> *.go ./</span>

<span class="hljs-keyword">FROM</span> base as build
<span class="hljs-keyword">RUN</span><span class="bash"> go build -v -o ./app ./</span>
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;/app/app&quot;</span>]</span>

<span class="hljs-keyword">FROM</span> base as test
<span class="hljs-keyword">RUN</span><span class="bash"> [<span class="hljs-string">&quot;go&quot;</span>, <span class="hljs-string">&quot;test&quot;</span> ,<span class="hljs-string">&quot;-v&quot;</span>, <span class="hljs-string">&quot;./...&quot;</span>]</span>
</code></pre>
<p><code>base</code> 스테이지에서 의존성을 설치한 뒤 각종 필요한 파일들을 복사하고 TLS 인증서 오류 해결을 위한 CA 인증서를 복사한다. <code>test</code> 스테이지는 <code>base</code> 스테이지에서 테스트 명령어를 실행하는 스테이지이며, <code>build</code> 스테이지는 <code>base</code> 스테이지를 바탕으로 도커 이미지를 빌드하는 스테이지이다.</p>
<p>따라서 위 Dockerfile을 이용해 <code>build</code> 스테이지까지 빌드하면 도커 이미지를 만드는 것이며, <code>test</code> 스테이지까지 빌드하면 테스트를 실행하게 되는 것이다. 이를 명령어로 나타내면 다음과 같으며, 캐시로 인해 테스트가 진행되지 않는 것을 방지하기 위해 <code>--no-cache</code> 매개변수를 추가했다.</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># Test</span>
DOCKER_BUILDKIT=1 docker build --no-cache --target <span class="hljs-built_in">test</span> .

<span class="hljs-comment"># Build</span>
DOCKER_BUILDKIT=1 docker build --target build</code></pre>
<p>테스트 실패시 Docker 빌드 오류가 발생한다. 이를 응용하면 다음과 같이 테스트 성공시 빌드를 진행하고, 실패시 오류 메세지를 출력하는 bash 스크립트를 작성할 수 있다.</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">export</span> DOCKER_BUILDKIT=1

docker build --no-cache --target <span class="hljs-built_in">test</span> .
test_status=$?
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$test_status</span> -eq 0 ]; <span class="hljs-keyword">then</span>
  docker build --taget build . --tag example-application
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ERROR while testing!&quot;</span>
<span class="hljs-keyword">fi</span></code></pre>
<h2 id="github-action을-이용한-활용">Github Action을 이용한 활용</h2>
<p>GitHub Action을 이용하면 다음과 같이 push시 테스트가 이루어지도록 할 수 있다.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Test</span>
<span class="hljs-attr">on:</span> <span class="hljs-string">push</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Test</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">docker</span> <span class="hljs-string">build</span> <span class="hljs-string">--no-cache</span> <span class="hljs-string">--target</span> <span class="hljs-string">test</span> <span class="hljs-string">.</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DOCKER_BUILDKIT:</span> <span class="hljs-number">1</span>
</code></pre>
<p>빌드도 잘 되는지 확인하고 싶다면 빌드하는 job을 하나 더 추가하면 된다.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">test</span>
<span class="hljs-attr">on:</span> <span class="hljs-string">push</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">docker</span> <span class="hljs-string">build</span> <span class="hljs-string">--target</span> <span class="hljs-string">build</span> <span class="hljs-string">.</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DOCKER_BUILDKIT:</span> <span class="hljs-number">1</span>

  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Test</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">docker</span> <span class="hljs-string">build</span> <span class="hljs-string">--no-cache</span> <span class="hljs-string">--target</span> <span class="hljs-string">test</span> <span class="hljs-string">.</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DOCKER_BUILDKIT:</span> <span class="hljs-number">1</span>
</code></pre>
<h1 id="결론">결론</h1>
<p>Docker 이미지로 배포를 진행하는 경우, Docker로 테스트도 같이 진행하면 실제 배포 환경과 유사한 환경에서 테스트를 진행할 수 있다는 큰 장점이 있다. 따라서 복잡한 어플리케이션이라면 이 글을 참고해 Docker로 테스트도 같이 하는 것이 좋은 선택이 될 수 있다.</p>
</section><div class="Comments_blogComments__GRWmY"></div><nav class="Blog_postNav__ivy8_ Blog_hasBoth__3MRPr"><div class="Blog_leftAnchor__HhzIP"><a href="/post/fcitx5_for_101_key_keyboard_kde_laptop"><div class="Blog_postDescription__eV92_"><div class="Blog_title___OFu6">한글 입력을 위한 fcitx5 설치</div><div class="Blog_subtitle__RRFh7">KDE 노트북에서의 버그없는 한글 입력을 위한 삽질기</div></div></a></div><div class="Blog_rightAnchor__B9n7B"><a href="/post/korean_style_award_with_latex"><div class="Blog_postDescription__eV92_"><div class="Blog_title___OFu6">LaTeX을 이용한 한국식 상장 템플릿</div><div class="Blog_subtitle__RRFh7">한국인이라면 한 번쯤 봤을 법한 그 양식</div></div></a></div></nav></div></main><footer class="Layout_footer__bKkxe"><div class="Layout_container__z4qWC"><a href="https://www.gnu.org/licenses/agpl-3.0.en.html"><img alt="GNU Affero General License Version 3" src="https://www.gnu.org/graphics/agplv3-with-text-100x42.png" style="height:31px"/></a> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"/></a><br/>Copyrights (C) 2020 LiteHell, All rights reserved.<br/><div class="Layout_visibleOnPrintOnly__UK6Yl">LiteHell&#x27;s Blog - <a href="https://blog.litehell.info">https://blog.litehell.info</a><br/>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.<br/><br/>Url of this article: <a href="https://blog.litehell.info/post/docker_for_testing">https://blog.litehell.info/post/docker_for_testing</a><br/></div><div class="Layout_invisibleOnPrint__rdrDv">Fox Image : Copyrights (C) 2004 Shiretoko-Shari Torurist Association<br/><a href="/license">This blog is free software; For source code and more informations on license and copyrights, Click here.</a><br/><br/>Feeds : <a href="/feed/rss">RSS 2.0</a>,<!-- --> <a href="/feed/atom">Atom 1.0</a>, <a href="/feed/json">Json 1.0</a></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"metadata":{"title":"Docker로 테스트하기","subtitle":"Docker로 빌드만 하지 말고 테스트도 하자","author":"LiteHell","date":"2023-10-25T14:49:49.041Z","category":"Dev","tags":["Docker"]},"rendered":"\u003ch1 id=\"들어가는-글\"\u003e들어가는 글\u003c/h1\u003e\n\u003cp\u003e필자는 중앙대학교 공지사항을 \u003ca href=\"https://rss.puang.network\"\u003eRSS\u003c/a\u003e로 만들어서 구독한다. RSS로 만든 후 메신지 봇을 붙이면 알아서 알려주니 편하다.\u003c/p\u003e\n\u003cp\u003e그러나 최근 해당 RSS 프로그램의 테스트가 실패하는 현상이 발견됐다. 확인한 결과, \u003ca href=\"https://swedu.cau.ac.kr\"\u003e중앙대학교 SW교육원\u003c/a\u003e 홈페이지의 TLS 인증서 이슈였던 것으로 확인됐다. 따라서 이를 해결하기 위해 일단 실행되고 있는 Docker 컨테이너에 직접 접근해서 해당 사이트의 CA 인증서를 설치했다.\u003c/p\u003e\n\u003ch1 id=\"기존-테스트-방법의-한계점\"\u003e기존 테스트 방법의 한계점\u003c/h1\u003e\n\u003cp\u003e버그는 일단 임시방편으로 수정한 것이니 레포에는 반영되지 않았다. 따라서 테스트 실패 메일이 매일매일 내 메일함으로 전송됐다.\u003c/p\u003e\n\u003cp\u003e어떻게 하면 이 버그를 수정하고 잘 테스트할 수 있을까? 먼저 이 버그를 수정하려면 Dockerfile을 수정해야 한다. Dockerfile에 다음 내용을 추가하여 Docker 이미지 빌드시 CA 인증서를 복사하도록 했다. \u003ca href=\"https://github.com/LiteHell/cau-rss/commit/d765d53d61e9370f5a284068ed273570d21013a3\"\u003eLiteHell/cau-rss 레포의 커밋 21013a3\u003c/a\u003e에서 확인할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e swedu-cert.pem /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/share/ca-certificates/swedu-cert.crt\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e cat /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/share/ca-certificates/swedu-cert.crt \u0026gt;\u0026gt; /etc/ssl/certs/ca-certificates.crt\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 위 버그 수정도 같이 테스트해야 한다. 아래에 있는 기존의 GitHub Action으로는 이 버그 수정을 테스트할 수 없다. \u003ccode\u003ego test -v ./...\u003c/code\u003e 명령어가 빌드된 Docker 이미지 내에서 실행되는 것이 아니기 때문이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-v\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./...\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTest\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-v\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./...\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e어떻게 하면 테스트할 수 있을까? 답은 간단하다. Docker로 테스트도 하면 된다.\u003c/p\u003e\n\u003ch1 id=\"docker를-이용한-테스트\"\u003eDocker를 이용한 테스트\u003c/h1\u003e\n\u003ch2 id=\"multi-stage-빌드\"\u003eMulti-stage 빌드\u003c/h2\u003e\n\u003cp\u003eDocker는 빌드를 여러 단계로 나누어 진행할 수 있다. 아래 예시 Dockerfile을 보자.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node AS base\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /app\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eADD\u003c/span\u003e\u003cspan class=\"bash\"\u003e src package.json package-lock.json tsconfig.json .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm i\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm bulid\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTypescript 프로젝트를 위한 간단한 Dockerfile이다. 이를 다음과 같이 여러개의 단계(stage)로 쪼갤 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node AS base\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /app\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eADD\u003c/span\u003e\u003cspan class=\"bash\"\u003e src package.json package-lock.json tsconfig.json .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e base AS deps\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm i\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e deps AS build\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm bulid\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e build As deployment\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위와 같은 Dockerfile을 이용하면 Docker 빌드시 특정 스테이지까지만 빌드할 수 있다. 예를 들어 아래 명령어는 deps 스테이지까지만 빌드한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker build --target deps\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e스테이지가 직선적이여야 할 필요는 없다. 다음과 같이 스테이지가 중간에 분기하도록 작성할 수도 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node AS base\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /app\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eADD\u003c/span\u003e\u003cspan class=\"bash\"\u003e src package.json package-lock.json tsconfig.json .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e base AS deps\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm i\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e deps AS build\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm bulid\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e build As english\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e english .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e english As deployment-international\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;--lang=english\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e build As korean\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e korean .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e korean AS deployment-domestic\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;--lang=korean\u0026quot;\u003c/span\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 Dockerfile의 경우 build 스테이지에서 english 스테이지와 korean 스테이지로 분기한다.\u003c/p\u003e\n\u003ch3 id=\"buildkit\"\u003eBuildKit\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node AS base\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /app\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eADD\u003c/span\u003e\u003cspan class=\"bash\"\u003e src package.json package-lock.json tsconfig.json .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e base AS deps\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm i\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e deps AS build\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm bulid\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e build As english\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e english .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e english As deployment-international\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;--lang=english\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e build As korean\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e korean .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e korean AS deployment-domestic\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;yarn\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;--lang=korean\u0026quot;\u003c/span\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 Dockerfile을 가지고 아래 명령어를 실행한다고 가정해보자.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker build --target deployment-domestic\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 경우 빌드에 필요한 스테이지는 \u003ccode\u003ebase\u003c/code\u003e, \u003ccode\u003edeps\u003c/code\u003e, \u003ccode\u003ebuild\u003c/code\u003e, \u003ccode\u003ekorean\u003c/code\u003e, \u003ccode\u003edeployment-domestic\u003c/code\u003e이다. 그러나 실제로 위 명령어를 실행해보면 불필요한 \u003ccode\u003eenglish\u003c/code\u003e, \u003ccode\u003edeployment-international\u003c/code\u003e 스테이지도 빌드하는 것을 확인할 수 있다.\u003c/p\u003e\n\u003cp\u003e이는 도커 레거시 빌더를 이용하기 때문에 생기는 문제이다. \u003ca href=\"https://docs.docker.com/build/buildkit/\"\u003eDocker BuildKit\u003c/a\u003e은 사용되지 않는 스테이지를 자동으로 파악하여 불필요한 스테이지는 빌드를 생략한다. 따라서 Docker BuildKit을 설치한 후 다음 명령어로 빌드하면 필요한 스테이지만 빌드할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eDOCKER_BUILDKIT=1 docker build --target deployment-domestic\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"multi-stage-빌드를-이용한-테스트\"\u003eMulti-stage 빌드를 이용한 테스트\u003c/h2\u003e\n\u003cp\u003e이제 Docker를 이용해 테스트를 하는 방법에 대해 알아보자. 다음은 \u003ca href=\"https://github.com/LiteHell/cau-rss\"\u003ecau-rss 레포\u003c/a\u003e의 Dockerfile 내용을 약간 수정한 예시이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e golang:alpine as base\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /app\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e go.mod go.sum ./\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e go mod download \u0026amp;\u0026amp; go mod verify\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e cau_parser ./cau_parser\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e server ./server\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# To avoid tls error from swedu.cau.ac.kr\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e swedu-cert.pem /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/share/ca-certificates/swedu-cert.crt\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e cat /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/share/ca-certificates/swedu-cert.crt \u0026gt;\u0026gt; /etc/ssl/certs/ca-certificates.crt\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e static ./static\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e html ./html\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e *.go ./\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e base as build\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e go build -v -o ./app ./\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;/app/app\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e base as test\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;go\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;test\u0026quot;\u003c/span\u003e ,\u003cspan class=\"hljs-string\"\u003e\u0026quot;-v\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;./...\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ebase\u003c/code\u003e 스테이지에서 의존성을 설치한 뒤 각종 필요한 파일들을 복사하고 TLS 인증서 오류 해결을 위한 CA 인증서를 복사한다. \u003ccode\u003etest\u003c/code\u003e 스테이지는 \u003ccode\u003ebase\u003c/code\u003e 스테이지에서 테스트 명령어를 실행하는 스테이지이며, \u003ccode\u003ebuild\u003c/code\u003e 스테이지는 \u003ccode\u003ebase\u003c/code\u003e 스테이지를 바탕으로 도커 이미지를 빌드하는 스테이지이다.\u003c/p\u003e\n\u003cp\u003e따라서 위 Dockerfile을 이용해 \u003ccode\u003ebuild\u003c/code\u003e 스테이지까지 빌드하면 도커 이미지를 만드는 것이며, \u003ccode\u003etest\u003c/code\u003e 스테이지까지 빌드하면 테스트를 실행하게 되는 것이다. 이를 명령어로 나타내면 다음과 같으며, 캐시로 인해 테스트가 진행되지 않는 것을 방지하기 위해 \u003ccode\u003e--no-cache\u003c/code\u003e 매개변수를 추가했다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Test\u003c/span\u003e\nDOCKER_BUILDKIT=1 docker build --no-cache --target \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e .\n\n\u003cspan class=\"hljs-comment\"\u003e# Build\u003c/span\u003e\nDOCKER_BUILDKIT=1 docker build --target build\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e테스트 실패시 Docker 빌드 오류가 발생한다. 이를 응용하면 다음과 같이 테스트 성공시 빌드를 진행하고, 실패시 오류 메세지를 출력하는 bash 스크립트를 작성할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e DOCKER_BUILDKIT=1\n\ndocker build --no-cache --target \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e .\ntest_status=$?\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e [ \u003cspan class=\"hljs-variable\"\u003e$test_status\u003c/span\u003e -eq 0 ]; \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e\n  docker build --taget build . --tag example-application\n\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;ERROR while testing!\u0026quot;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efi\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"github-action을-이용한-활용\"\u003eGithub Action을 이용한 활용\u003c/h2\u003e\n\u003cp\u003eGitHub Action을 이용하면 다음과 같이 push시 테스트가 이루어지도록 할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTest\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epush\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etest:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuildx\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker/setup-buildx-action@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTest\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--no-cache\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--target\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eDOCKER_BUILDKIT:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e빌드도 잘 되는지 확인하고 싶다면 빌드하는 job을 하나 더 추가하면 된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epush\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuildx\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker/setup-buildx-action@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--target\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eDOCKER_BUILDKIT:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003etest:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuildx\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker/setup-buildx-action@v3\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTest\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--no-cache\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--target\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eDOCKER_BUILDKIT:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1 id=\"결론\"\u003e결론\u003c/h1\u003e\n\u003cp\u003eDocker 이미지로 배포를 진행하는 경우, Docker로 테스트도 같이 진행하면 실제 배포 환경과 유사한 환경에서 테스트를 진행할 수 있다는 큰 장점이 있다. 따라서 복잡한 어플리케이션이라면 이 글을 참고해 Docker로 테스트도 같이 하는 것이 좋은 선택이 될 수 있다.\u003c/p\u003e\n"},"articleId":"docker_for_testing","previousPost":{"name":"fcitx5_for_101_key_keyboard_kde_laptop","metadata":{"title":"한글 입력을 위한 fcitx5 설치","subtitle":"KDE 노트북에서의 버그없는 한글 입력을 위한 삽질기","author":"LiteHell","date":"2023-10-17T12:34:16.790Z","category":"Linux","tags":["Linux","Korean","Hangul","IM","KDE"],"last_modified_at":"2023-10-17T14:32:47.687Z"},"rendered":"\u003ch1 id=\"서론\"\u003e서론\u003c/h1\u003e\n\u003cp\u003e필자는 초창기에 \u003ca href=\"https://github.com/ibus/ibus\"\u003eibus\u003c/a\u003e를 썼었다. ibus는 웬만한 프로그램에서 아무 버그없이 잘 작동한다. 딱 한가지, 리브레오피스에서 공백 입력이 안 된다는 치명적인 버그만 빼면 말이다.\u003c/p\u003e\n\u003cp\u003e그래서 ibus 다음으로 \u003ca href=\"https://github.com/hamonikr/nimf\"\u003e하모니카에서 유지보수하는 nimf\u003c/a\u003e를 썼었다. nimf는 리브레오피스에서의 치명적인 버그는 없었지만, 엔터키를 누르면 텍스트가 사라지는 버그가 있었다. 근데 이 버그, 처음에만 짜증나지 좀 지나면 적응된다. 그래서 적응해서 쓰다가 생각해보니 \u0026#39;이건 좀 아닌 것 같다\u0026#39;싶어서 다른 입력기를 설치했다.\u003c/p\u003e\n\u003cp\u003e본 블로그 글은 \u003ca href=\"https://archlinux.org/\"\u003eArch Linux\u003c/a\u003e를 기준으로 설명한다.\u003c/p\u003e\n\u003ch2 id=\"kde에서의-키보드-레이아웃\"\u003eKDE에서의 키보드 레이아웃\u003c/h2\u003e\n\u003cp\u003e입력기를 바꾸기 위해 삽질하는 과정에서 한글키가 오른쪽 Alt키로 인식되는 현상을 확인했다. 분명히 아치 리눅스 설치 초기에 매핑을 했었는데, 시스템 업데이트를 하는 과정에서 원상복구가 된 것 같다. 그래서 이번에는 KDE 설정 프로그램을 이용해 한글키와 한자키를 매핑했다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/kde_keyboard_settings.png\" alt=\"KDE 키보드 설정 프로그램\"\u003e\u003c/p\u003e\n\u003cp\u003e위와 같이 시스템 설정 프로그램의 \u003cstrong\u003e입력 장치 🠞 키보드\u003c/strong\u003e 화면에서 \u003cstrong\u003e오른쪽 Alt 키를 한/영 키로 만들기\u003c/strong\u003e, \u003cstrong\u003e오른쪽 Ctrl 키를 한자 키로 만들기\u003c/strong\u003e 항목을 체크하면 된다. (키보드 레이아웃에 따라 약간 다를 수 있다.) 노트북 등의 101/104키 호환 레이아웃이라면 위 과정을 반드시 거쳐야 한다.\u003c/p\u003e\n\u003ch3 id=\"한영-한자키-인식여부-확인방법\"\u003e한/영, 한자키 인식여부 확인방법\u003c/h3\u003e\n\u003cp\u003e본인 키보드가 101/104키인지 106키인지 헷갈린다면 \u003cdel\u003e키보드 키 갯수 세지말고\u003c/del\u003e 먼저 \u003ccode\u003exev\u003c/code\u003e 프로그램을 설치한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esudo pacman -S xorg-xev\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그리고 콘솔 창에서 xev 프로그램을 실행한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003exev\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003exev 프로그램 창을 활성화하고 한글키랑 한자키를 눌러본다. 다음과 같이 콘솔 창에 \u003cem\u003eHangul\u003c/em\u003e이나 \u003cem\u003eHangul_Hanja\u003c/em\u003e키가 인식된 메세지가 출력되면 한/영 키, 한자 키가 정상적으로 인식되는 것이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eKeyRelease event, serial 39, synthetic NO, window 0x9000001,\n    root 0x79b, subw 0x0, time 1234567, (-10, 10), root:(10, 10),\n    state 0x0, keycode 108 (keysym 0xff31, Hangul), same_screen YES,\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003eKeyPress event, serial 39, synthetic NO, window 0x9000001,\n    root 0x79b, subw 0x0, time 1234567, (10, 10), root:(10, 10),\n    state 0x0, keycode 105 (keysym 0xff34, Hangul_Hanja), same_screen YES,\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e만약 위와 같은 메세지가 안 뜨고 Alt_R이나 Control_R이 인식된다면 \u003ca href=\"#kde에서의-키보드-레이아웃\"\u003e위에 써진 내용\u003c/a\u003e에 따라 매핑하면 된다.\u003c/p\u003e\n\u003ch2 id=\"fcitx5-설치-방법\"\u003efcitx5 설치 방법\u003c/h2\u003e\n\u003cp\u003e먼저, 다음 명령어를 실행해 fcitx5를 설치한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esudo pacman -S fcitx5-im fcitx-hangul\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e/etc/environment\u003c/code\u003e 파일에 다음 내용을 추가한다. 입력기로 fcitx를 쓰도록 지정하는 작업이다.\u003c/p\u003e\n\u003c!-- ini파일이 아니지만 syntax highlighting을 위해 형식을 ini으로 지정함 ---\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003e\u003cspan class=\"hljs-attr\"\u003eGTK_IM_MODULE\u003c/span\u003e=fcitx\n\u003cspan class=\"hljs-attr\"\u003eQT_IM_MODULE\u003c/span\u003e=fcitx\n\u003cspan class=\"hljs-attr\"\u003eQT4_IM_MODULE\u003c/span\u003e=fcitx\n\u003cspan class=\"hljs-attr\"\u003eQT5_IM_MODULE\u003c/span\u003e=fcitx\n\u003cspan class=\"hljs-attr\"\u003eXMODIFIERS\u003c/span\u003e=@im=fcitx\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그 다음에 \u003ccode\u003e~/.xprofile\u003c/code\u003e 파일에 다음 내용을 추가한다. 부팅시에 fcitx5가 실행되도록 한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efcitx5 -d\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e재부팅하고 \u003ccode\u003eenv | grep fcitx\u003c/code\u003e 명령어를 실행해 환경변수가 제대로 변경됐는지 확인해보자. 제대로 변경됐다면 다음과 같이 뜰 것이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eGTK_IM_MODULE=fcitx\nQT4_IM_MODULE=fcitx\nXMODIFIERS=@im=fcitx\nQT5_IM_MODULE=fcitx\nQT_IM_MODULE=fcitx\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e만약 환경변수가 제대로 변경되지 않았다면 \u003ccode\u003e~/.xprofile\u003c/code\u003e 파일에서 \u003ccode\u003efcitx5 -d\u003c/code\u003e 위에 다음 내용을 추가하고 재부팅한다. 그러면 환경변수가 정상적으로 변경될 것이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e $(/usr/lib/systemd/user-environment-generators/30-systemd-environment-d-generator)\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"fcitx5-설정\"\u003efcitx5 설정\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003efcitx5-configtool\u003c/code\u003e 명령어를 실행하면 다음 창이 뜬다.\n\u003cimg src=\"/img/fcitx5_settings_first_screen.png\" alt=\"fcitx5 KDE 설정 창\"\u003e\u003c/p\u003e\n\u003cp\u003e위 화면에서 한국어가 안 보이면 \u003cstrong\u003e입력기 추가\u003c/strong\u003e버튼을 눌러서 추가한다. (입력기 추가 화면에서 한국어가 안 보이면 \u003cstrong\u003e현재 언어만 표시\u003c/strong\u003e 옵션을 해제하면 된다.)\u003c/p\u003e\n\u003cp\u003e밑에서 \u003cstrong\u003e전역 옵션 구성하기...\u003c/strong\u003e 버튼을 누르면 다음 화면이 뜬다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/fcitx5_global_settings.png\" alt=\"fcitx5 KDE 설정 창\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eTrigger Input Method\u003c/strong\u003e가 한/영을 전환하는 단축키 설정이다. 오른쪽의 \u003cstrong\u003e+\u003c/strong\u003e 버튼을 눌러 한글 키를 추가하면 된다.\u003c/p\u003e\n\u003cp\u003efcitx5는 기본적으로 한/영을 전환할때 작은 툴팁을 표시한다. 거슬리면 위 화면에서 \u003cstrong\u003eShow Input Method Information when switch input method\u003c/strong\u003e를 체크 해제하면 된다.\u003c/p\u003e\n\u003cp\u003e이제 한글 입력을 버그없이 잘 할 수 있게 됐다. 끝!\u003c/p\u003e\n"},"nextPost":{"name":"korean_style_award_with_latex","metadata":{"title":"LaTeX을 이용한 한국식 상장 템플릿","subtitle":"한국인이라면 한 번쯤 봤을 법한 그 양식","author":"LiteHell","date":"2023-11-05T04:26:36.499Z","category":"LaTeX","tags":["TikZ"]},"rendered":"\u003ch1 id=\"들어가는-말\"\u003e들어가는 말\u003c/h1\u003e\n\u003cp\u003e최근 \u003ca href=\"https://cauchaos.github.io\"\u003e알고리즘 동아리\u003c/a\u003e에서 주최한 \u003ca href=\"https://www.acmicpc.net/contest/view/1100\"\u003e대회\u003c/a\u003e에 운영진으로 참가했다. 대회가 마무리된 후 1,2,3등을 위한 상장을 만들어야 했는데 이때 LaTeX를 써보면 재밌을 것 같다는 생각이 들었다.\u003c/p\u003e\n\u003cp\u003e따라서 LaTeX을 이용해 아래와 같은 상장을 만들었다.\u003c/p\u003e\n\u003ch1 id=\"tikz\"\u003eTikZ\u003c/h1\u003e\n\u003cp\u003eTikZ는 LaTeX에서 그림을 그릴 때 쓰는 패키지이다. 주로 pgfplots와 함께 사용하거나 그래프를 그릴 때 이용되지만 간단한 그림 정도는 그릴 수 있다.\u003c/p\u003e\n\u003ch2 id=\"current-page\"\u003ecurrent page\u003c/h2\u003e\n\u003cp\u003eTikZ에는 \u003ccode\u003ecurrent page\u003c/code\u003e라는 특별한 노드가 있다. 이 노드는 \u003ccode\u003ecurrent page.south west\u003c/code\u003e나 \u003ccode\u003ecurrent page.west\u003c/code\u003e와 같이 이용되며, 페이지의 모서리를 가리키고 있다.\u003c/p\u003e\n\u003cp\u003e아래 예시를 보자. TikZ \u0026amp; PGF 메뉴얼 3.1.10버전의 260페이지에 있는 예시이다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-latex\"\u003e\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{tikzpicture}[remember picture, overlay]\n    \u003cspan class=\"hljs-keyword\"\u003e\\draw\u003c/span\u003e [line width=1mm, opacity=.25]\n        (current page.center) circle (3cm);\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{tikzpicture}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 예시 코드를 빌드하면 페이지의 정중앙에 반지름이 3cm인 원이 그려진다. 위 코드에서 \u003ccode\u003eremember picture\u003c/code\u003e와 \u003ccode\u003eoverlay\u003c/code\u003e는 \u003ccode\u003ecurrent page\u003c/code\u003e 노드를 사용하기 위해 필요하다.\u003c/p\u003e\n\u003ch2 id=\"호-그리기\"\u003e호 그리기\u003c/h2\u003e\n\u003cp\u003eTikZ는 \u003ccode\u003e\\draw arc (시작각도:종료각도:반지름)\u003c/code\u003e 형태의 명령어로 호(arc)도 그릴 수 있다.\u003c/p\u003e\n\u003ch2 id=\"cycle\"\u003ecycle\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ecycle\u003c/code\u003e을 이용하면 마지막 노드에서 다시 처음 노드로 이어지는 닫힌 경로를 만들 수 있다.\u003c/p\u003e\n\u003cp\u003e예시를 보면 이해가 쉽다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-latex\"\u003eWithout cycle\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{tikzpicture}\n\u003cspan class=\"hljs-keyword\"\u003e\\draw\u003c/span\u003e (0, 0) -- (1, 1) -- (2, 0);\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{tikzpicture}\n\nWith cycle\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{tikzpicture}\n\u003cspan class=\"hljs-keyword\"\u003e\\draw\u003c/span\u003e (0, 0) -- (1, 1) -- (2, 0) -- cycle;\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{tikzpicture}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 코드를 빌드하면 아래와 같은 결과가 나온다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/latex_tikz_cycle.png\" alt=\"tikz cycle 에시 이미지\"\u003e\u003c/p\u003e\n\u003ch1 id=\"상장-템플릿-소스코드\"\u003e상장 템플릿 소스코드\u003c/h1\u003e\n\u003cp\u003e본 템플릿에서 그린 상장 테두리 장식은 호와 직선만을 이용해 그릴 수 있는 기하학적인 무늬(문방구 상장용지에서 흔히 볼 수 있는 무늬)이다. 따라서 TikZ를 잘 활용하면 상장 테두리 장식을 그릴 수 있다.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://gist.github.com/LiteHell/43abe5fcb711676d392d8d1900d5e1e5\"\u003eGitHub Gist\u003c/a\u003e에서도 볼 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-latex\"\u003e\u003cspan class=\"hljs-keyword\"\u003e\\documentclass\u003c/span\u003e{minimal}\n\u003cspan class=\"hljs-keyword\"\u003e\\usepackage\u003c/span\u003e{kotex}\n\u003cspan class=\"hljs-keyword\"\u003e\\usepackage\u003c/span\u003e[svgnames]{xcolor}\n\u003cspan class=\"hljs-keyword\"\u003e\\usepackage\u003c/span\u003e{tikz}\n\u003cspan class=\"hljs-keyword\"\u003e\\usepackage\u003c/span\u003e[a4paper, top=100pt, left=80pt, right=80pt, bottom=120pt]{geometry}\n\u003cspan class=\"hljs-keyword\"\u003e\\usetikzlibrary\u003c/span\u003e{calc}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e}{40pt}\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\thickframewidth\u003c/span\u003e}{6pt}\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e}{46pt}\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\thinframewidth\u003c/span\u003e}{1pt}\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e}{30pt}\n\u003cspan class=\"hljs-keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\framecolor\u003c/span\u003e}{Goldenrod}\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{document}\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{tikzpicture}[remember picture, overlay]\n    \u003cspan class=\"hljs-comment\"\u003e% thick corner\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003e\\draw\u003c/span\u003e[color=\u003cspan class=\"hljs-keyword\"\u003e\\framecolor\u003c/span\u003e, line width=\u003cspan class=\"hljs-keyword\"\u003e\\thickframewidth\u003c/span\u003e]\n     \u003cspan class=\"hljs-comment\"\u003e% north west rounded corner\u003c/span\u003e\n    ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e-2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.north west) arc (270:450:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.north west) arc (180:360:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n     \u003cspan class=\"hljs-comment\"\u003e% north east rounded croner\u003c/span\u003e\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e-2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.north east) arc (180:360:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.north east) arc (90:270:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n     \u003cspan class=\"hljs-comment\"\u003e% south east rounded corner\u003c/span\u003e\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e+2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.south east) arc (90:270:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.south east) arc (0:180:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    \u003cspan class=\"hljs-comment\"\u003e% south west rounded corner\u003c/span\u003e\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e+2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.south west) arc (0:180:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thickframemargin\u003c/span\u003e] current page.south west) arc (270:450:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    \u003cspan class=\"hljs-comment\"\u003e% cycle\u003c/span\u003e\n    -- cycle;\n\n\n    \u003cspan class=\"hljs-comment\"\u003e% thin corner\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003e\\draw\u003c/span\u003e[color=\u003cspan class=\"hljs-keyword\"\u003e\\framecolor\u003c/span\u003e, line width=\u003cspan class=\"hljs-keyword\"\u003e\\thinframewidth\u003c/span\u003e]\n     \u003cspan class=\"hljs-comment\"\u003e% north west rounded corner\u003c/span\u003e\n    ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.north west) arc (270:360:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.north west) arc (270:360:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n     \u003cspan class=\"hljs-comment\"\u003e% north east rounded croner\u003c/span\u003e\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e] current page.north east) arc (180:270:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.north east) arc (180:270:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n     \u003cspan class=\"hljs-comment\"\u003e% south east rounded corner\u003c/span\u003e\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.south east) arc (90:180:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=-\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e-\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.south east) arc (90:180:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    \u003cspan class=\"hljs-comment\"\u003e% south west rounded corner\u003c/span\u003e\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+2*\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e] current page.south west) arc (0:90:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    -- ([xshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e, yshift=\u003cspan class=\"hljs-keyword\"\u003e\\thinframemargin\u003c/span\u003e+\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e] current page.south west) arc (0:90:\u003cspan class=\"hljs-keyword\"\u003e\\framecornerradius\u003c/span\u003e)\n    \u003cspan class=\"hljs-comment\"\u003e% cycle\u003c/span\u003e\n    -- cycle;\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{tikzpicture}\n\u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{16pt}{16pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e 제 1 호\n\n\u003cspan class=\"hljs-keyword\"\u003e\\vspace\u003c/span\u003e{32pt}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{center}\n\u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{48pt}{48pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e\n상\u003cspan class=\"hljs-keyword\"\u003e\\hspace\u003c/span\u003e{1.25em}장\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{center}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\vspace\u003c/span\u003e{50pt}\n\n\n\u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{20pt}{20pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e\n최우수상\u003cspan class=\"hljs-keyword\"\u003e\\hspace\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\stretch\u003c/span\u003e{1}}홍길동\n\n\n\u003cspan class=\"hljs-keyword\"\u003e\\vspace\u003c/span\u003e{80pt}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{center}\n \u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{20pt}{30pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e\n 위 사람은 \u003cspan class=\"hljs-keyword\"\u003e\\LaTeXe\u003c/span\u003e를 잘 활용하여 타의 모범이 되었으므로 이 상을 수여합니다.\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{center}\n\n\n\u003cspan class=\"hljs-keyword\"\u003e\\vspace\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003e\\stretch\u003c/span\u003e{1}}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{center}\n \u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{20pt}{20pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e\n 1970년 1월 1일\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{center}\n\n\n\u003cspan class=\"hljs-keyword\"\u003e\\vspace\u003c/span\u003e{2em}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\begin\u003c/span\u003e{center}\n \u003cspan class=\"hljs-keyword\"\u003e\\fontsize\u003c/span\u003e{30pt}{30pt}\u003cspan class=\"hljs-keyword\"\u003e\\selectfont\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003e\\LaTeXe\u003c/span\u003e{} 애호가 김철수\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{center}\n\n\u003cspan class=\"hljs-keyword\"\u003e\\end\u003c/span\u003e{document}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1 id=\"사진\"\u003e사진\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/img/latex_korean_award.png\" alt=\"한국식 상장 템플릿\"\u003e\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/post/[id]","query":{"id":"docker_for_testing"},"buildId":"awhFjBdq9zgQaqX8Z7gzv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>